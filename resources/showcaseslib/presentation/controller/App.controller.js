sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","showcaseslib/shared/data/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,n,i,s,o){"use strict";return t.extend("showcaseslib.showcase.controller.App",{formatter:i,_iCarouselLoopTime:4e3,onInit:function(){var e=sap.ui.require.toUrl("showcaseslib")+"/shared/data/model/showcases.json";var t=new n(e);this.getView().setModel(t);this.getCarouselPresentation().addEventDelegate({onAfterRendering:function(){this.setOnlyFirstImageOfEachShowcaseVisible()}.bind(this)});this.registerEvents()},registerEvents:function(){var t=this.byId("flexboxButtons");var n=this.byId("presentationPage");n.addEventDelegate({ontap:function(t){if(e(t.target).control()[0].getMetadata().getName()==="sap.m.Image"){this.onPressButtonTogglePresentation()}}.bind(this)});n.attachBrowserEvent("mouseenter",function(){t.setVisible(true)}.bind(this));n.attachBrowserEvent("mouseleave",function(){t.setVisible(false)}.bind(this));n.attachBrowserEvent("mousemove",function(){t.setVisible(true);clearTimeout(this.timeoutHandlerMouseMove);this.timeoutHandlerMouseMove=setTimeout(function(){t.setVisible(false)}.bind(this),5e3)}.bind(this));document.addEventListener("fullscreenchange",this.onExitFullScreen.bind(this));document.addEventListener("webkitfullscreenchange",this.onExitFullScreen.bind(this));document.addEventListener("mozfullscreenchange",this.onExitFullScreen.bind(this));document.addEventListener("MSFullscreenChange",this.onExitFullScreen.bind(this));document.addEventListener("keyup",this.onKeyUp.bind(this))},onExit:function(){this.onPressButtonResetPresentation()},onRouteMatched:function(e,t){var n=this.getCarouselPresentation();this._bExternal=t===true;if(t){var i=n.getBinding("pages");var a=new s("classification",o.EQ,"public");i.filter(a)}n.setActivePage(n.getPages()[e||0]);this.setOnlyFirstImageOfEachShowcaseVisible();this.resetPositionsOfImages()},onKeyUp:function(e){var t=e.key||e.keyCode;if(t==" "||t==32){this.onPressButtonTogglePresentation()}},onPressButtonEndFullScreen:function(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}this.onPressButtonResetPresentation();var e=this.getActivePageId();this.getOwnerComponent().fireNavigateToOverview({navTarget:e})},onPressButtonTogglePresentation:function(){if(this.bIsPresenting){this.endPresentation()}else{this.startPresentation()}},onPressButtonResetPresentation:function(){this.byId("buttonToggle").setIcon("sap-icon://play");this.endPresentationAndAnimations();this.setOnlyFirstImageOfEachShowcaseVisible();this.resetPositionsOfImages();this.bIsPresenting=false},endPresentation:function(){this.byId("buttonToggle").setIcon("sap-icon://play");this.endPresentationAndAnimations();this.resetPositionsOfImages();this.bIsPresenting=false},onExitFullScreen:function(){if(!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement)){this.onPressButtonEndFullScreen()}},onPageChanged:function(){var e=this.getActivePageId();this.getOwnerComponent().fireNavigateToPresentation({navTarget:e});if(this.bIsPresenting){this.startPresentation()}},startPresentation:function(){this.byId("buttonToggle").setIcon("sap-icon://pause");this.resetPositionsOfImages();this.setOnlyFirstImageOfEachShowcaseVisible();this.bIsPresenting=true;var e=this.getCarouselPresentation();var t=this.getActivePageId();var n=e.getPages()[t].getItems()[0].getItems();n[0].$().context.style.display="inline-block";this.startImageAnimation(t,0)},loadImage:function(t,n,i){e("<img />").load(n).error(i).attr("src",t)},animateImage:function(e,t,n){var i=e[t].$(),s=e[t].getSrc();this.loadImage(s,function(e){var t=Math.min(100,Math.round(window.innerHeight/(window.innerWidth/e.target.width*e.target.height)*100))+"%";if(e.target.width/e.target.height>1){i.animate({"background-position-y":t,"background-size":"120%"},this._iCarouselLoopTime,"swing",function(){n()})}else{i.animate({"background-position-y":t,"background-size":"100%"},this._iCarouselLoopTime,"swing",function(){n()})}}.bind(this),n.bind(this))},startImageAnimation:function(e,t){var n=this.getCarouselPresentation();var i=this.getActivePageId();var s=n.getPages()[i].getItems()[0].getItems();if(this.bIsPresenting&&i===e){var o=t;var a=s[o].$();this.animateImage(s,o,function(){if(this.bIsPresenting&&i===e){var r=t+1;if(r<s.length){var l=s[r].$();l.fadeIn(this._iCarouselLoopTime/2,function(){this.resetImagePosition(s[o]);if(this.bIsPresenting&&i===e){this.startImageAnimation(e,r)}}.bind(this));a.fadeOut({duration:this._iCarouselLoopTime,queue:false})}else{n.next()}}}.bind(this))}},resetPositionsOfImages:function(){var e=this.getCarouselPresentation();var t=e.getPages();for(var n=0;n<t.length;n++){var i=t[n].getItems()[0].getItems();for(var s=0;s<i.length;s++){this.resetImagePosition(i[s])}}},resetImagePosition:function(e){e.setBackgroundPosition("center 0%");e.$().context.style["background-position-y"]="0%";e.$().context.style.opacity="1";this.loadImage(e.getSrc(),function(t){if(t.target.width/t.target.height>1){e.setBackgroundSize("100%");e.$().context.style["background-size"]="100%"}else{e.setBackgroundSize("66%");e.$().context.style["background-size"]="66%"}}.bind(this))},setOnlyFirstImageOfEachShowcaseVisible:function(){var e=this.getCarouselPresentation();setTimeout(function(){e.focus()},0);var t=e.getPages();for(var n=0;n<t.length;n++){var i=t[n].getItems()[0].getItems();for(var s=0;s<i.length;s++){i[s].$().context.style.display="none"}i[0].$().context.style.display="inline-block"}},endPresentationAndAnimations:function(){this.bIsPresenting=false;var e=this.getCarouselPresentation();var t=e.getPages();for(var n=0;n<t.length;n++){var i=t[n].getItems()[0].getItems();this.resetImagePosition(i[0]);for(var s=0;s<i.length;s++){i[s].$().stop()}}},getActivePageId:function(){var e=this.getCarouselPresentation().getActivePage().split("-");var t=e[e.length-1];return parseInt(t,10)},getCarouselPresentation:function(){if(this.oCarouselPresentation){return this.oCarouselPresentation}else{this.oCarouselPresentation=this.getView().byId("carouselPresentation");return this.oCarouselPresentation}}})});
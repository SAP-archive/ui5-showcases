/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/unified/library","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/DateRange","sap/ui/unified/CalendarAppointment","sap/ui/unified/CalendarRow","sap/ui/unified/CalendarRowRenderer","sap/ui/unified/CalendarDateInterval","sap/ui/unified/CalendarWeekInterval","sap/ui/unified/CalendarOneMonthInterval","sap/ui/unified/CalendarMonthInterval","sap/ui/unified/CalendarTimeInterval","sap/ui/Device","sap/ui/core/Element","sap/ui/core/Renderer","sap/ui/core/ResizeHandler","sap/ui/core/Item","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragDropInfo","sap/m/Select","sap/m/Button","sap/m/OverflowToolbar","sap/m/Toolbar","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ColumnListItemRenderer","sap/m/StandardListItem","sap/m/StandardListItemRenderer","sap/m/PlanningCalendarRow","sap/m/PlanningCalendarRenderer","sap/m/PlanningCalendarView","sap/m/CheckBox","sap/m/library","sap/base/util/deepEqual","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(e,t,a,n,i,r,s,o,l,h,g,p,d,u,c,f,v,m,D,w,y,_,C,S,I,T,A,b,M,R,k,P,H,V,N,E,O,x,z,L,B){"use strict";var W=n.CalendarDayType;var U=x.ListMode;var K=x.ToolbarDesign;var F=x.ButtonType;var Y=x.PlanningCalendarBuiltInView;var $=x.ScreenSize;var G=n.CalendarAppointmentVisualization;var j=n.GroupAppointmentsMode;var J=n.CalendarIntervalType;var q="DragDropConfig";var X="ResizeConfig";var Q="CreateConfig";var Z="-CLI";var ee=e.extend("sap.m.PlanningCalendar",{metadata:{library:"sap.m",properties:{startDate:{type:"object",group:"Data"},viewKey:{type:"string",group:"Appearance",defaultValue:J.Hour},singleSelection:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showRowHeaders:{type:"boolean",group:"Appearance",defaultValue:true},noDataText:{type:"string",group:"Misc",defaultValue:null},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:j.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:G.Standard},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showDayNamesLine:{type:"boolean",group:"Appearance",defaultValue:false},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:false},builtInViews:{type:"string[]",group:"Appearance",defaultValue:[]},stickyHeader:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{rows:{type:"sap.m.PlanningCalendarRow",multiple:true,singularName:"row"},views:{type:"sap.m.PlanningCalendarView",multiple:true,singularName:"view"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},toolbarContent:{type:"sap.ui.core.Control",multiple:true,singularName:"toolbarContent",forwarding:{getter:"_getTableHeaderToolbar",aggregation:"content"},forwardBinding:true},table:{type:"sap.m.Table",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{appointmentSelect:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"},row:{type:"sap.m.PlanningCalendarRow"}}},rowSelectionChange:{parameters:{rows:{type:"sap.m.PlanningCalendarRow[]"}}},startDateChange:{},viewChange:{},rowHeaderClick:{row:{type:"sap.m.PlanningCalendarRow"}}},designtime:"sap/m/designtime/PlanningCalendar.designtime"},constructor:function(t,a){e.prototype.constructor.apply(this,arguments);if(typeof t!=="string"){a=t}if(a&&typeof a.customAppointmentsSorterCallback==="function"){this._fnCustomSortedAppointments=a.customAppointmentsSorterCallback}}});var te=["_oTimeInterval","_oDateInterval","_oMonthInterval","_oWeekInterval","_oOneMonthInterval"],ae={};ae[J.Day]={sInstanceName:"_oDateInterval",sIdSuffix:"-DateInt",oClass:g};ae[J.Week]={sInstanceName:"_oWeekInterval",sIdSuffix:"-WeekInt",oClass:p};ae[J.OneMonth]={sInstanceName:"_oOneMonthInterval",sIdSuffix:"-OneMonthInt",oClass:d};var ne=$.Desktop;var ie=[Y.Hour,Y.Day,Y.Month,Y.Week,Y.OneMonth];var re={PHONE:"600",TABLET:"1024"};var se=["sap.ui.unified.CalendarTimeInterval","sap.ui.unified.CalendarDateInterval","sap.ui.unified.CalendarMonthInterval"];var oe=e.extend("CalendarHeader",{metadata:{aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false},allCheckBox:{type:"sap.m.CheckBox",multiple:false}}},renderer:function(e,t){e.write("<div");e.writeControlData(t);e.addClass("sapMPlanCalHead");e.writeClasses();e.write(">");var a=t.getToolbar();if(a){e.renderControl(a)}var n=t.getAllCheckBox();if(n){e.renderControl(n)}e.write("</div>")}});ee.prototype.init=function(){this._iBreakPointTablet=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];if(f.system.phone||B("html").hasClass("sapUiMedia-Std-Phone")){this._iSize=0;this._iSizeScreen=0}else if(f.system.tablet||B("html").hasClass("sapUiMedia-Std-Tablet")){this._iSize=1;this._iSizeScreen=1}else{this._iSize=2;this._iSizeScreen=2}this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.m");var e=this.getId();this._oIntervalTypeSelect=new S(e+"-IntType",{maxWidth:"15rem",ariaLabelledBy:e+"-SelDescr"});this._oIntervalTypeSelect.attachEvent("change",he,this);this._oTodayButton=new I(e+"-Today",{text:this._oRB.getText("PLANNINGCALENDAR_TODAY"),type:F.Transparent});this._oTodayButton.attachEvent("press",this._handleTodayPress,this);this._oHeaderToolbar=new A(e+"-HeaderToolbar",{design:K.Transparent,content:[this._oIntervalTypeSelect,this._oTodayButton]});this._oCalendarHeader=new oe(e+"-CalHead",{toolbar:this._oHeaderToolbar});this._oInfoToolbar=new A(e+"-InfoToolbar",{height:"auto",design:K.Transparent,content:[this._oCalendarHeader,this._oTimeInterval]});var t=new T(this.getId()+"-Toolbar",{design:K.Transparent,visible:false});t._oPlanningCalendar=this;var a=new b(e+"-Table",{sticky:[],infoToolbar:this._oInfoToolbar,headerToolbar:t,mode:U.SingleSelectMaster,columns:[new M({styleClass:"sapMPlanCalRowHead"}),new M({width:"80%",styleClass:"sapMPlanCalAppRow",minScreenWidth:ne,demandPopin:true})],ariaLabelledBy:e+"-Descr"});a.attachEvent("selectionChange",Te,this);a.addDelegate({onBeforeRendering:function(){if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off()}},onAfterRendering:function(){this._rowHeaderClickEvent=a.$().find(".sapMPlanCalRowHead > div.sapMLIB").click(function(e){var t=B(e.currentTarget).control(0),a=_e(t.getParent());this.fireRowHeaderClick({row:a})}.bind(this))}},false,this);this.setAggregation("table",a,true);this.setStartDate(new Date);this._resizeProxy=B.proxy(ue,this);this._fnCustomSortedAppointments=undefined;this.iWidth=0};ee.prototype.exit=function(){if(this._sResizeListener){D.deregister(this._sResizeListener);this._sResizeListener=undefined}f.orientation.detachHandler(this._updateStickyHeader,this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}var e=this.getAggregation("table");e.removeAllItems();te.forEach(function(e){if(this[e]){this[e]._oPlanningCalendar=undefined;this[e].destroy();this[e]=undefined}},this);if(this._oViews){for(var t in this._oViews){this._oViews[t].destroy()}}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.destroy()}if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();this._rowHeaderClickEvent=null}};ee.prototype.onBeforeRendering=function(){this._bBeforeRendering=true;if(!this._oTimeInterval&&!this._oDateInterval&&!this._oMonthInterval&&!this._oWeekInterval&&!this._oOneMonthInterval||this._bCheckView){this.setViewKey(this.getViewKey());this._bCheckView=undefined}Me.call(this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}this._updateTodayButtonState();f.orientation.detachHandler(this._updateStickyHeader,this);this._bBeforeRendering=undefined};ee.prototype.attachEvent=function(t,a,n,i){e.prototype.attachEvent.call(this,t,a,n,i);if(this.hasListeners("intervalSelect")){te.forEach(function(e){if(this[e]){this[e]._setAriaRole("button")}},this)}return this};ee.prototype.detachEvent=function(t,a,n){e.prototype.detachEvent.call(this,t,a,n);if(!this.hasListeners("intervalSelect")){te.forEach(function(e){if(this[e]){this[e]._setAriaRole("gridcell")}},this)}return this};ee.prototype._setAriaRole=function(e){if(this.hasListeners("intervalSelect")){e._setAriaRole("button")}else{e._setAriaRole("gridcell")}};ee.prototype._updateTodayButtonState=function(){if(this._oTodayButton){this._oTodayButton.setEnabled(!this._dateMatchesVisibleRange(new Date,this.getViewKey()))}};ee.prototype._dateMatchesVisibleRange=function(e,t){var a=this._getView(t,!this._bBeforeRendering);if(!a){return false}var n=a.getIntervalType(),i=ae[n],r=i?this[i.sInstanceName]:null,s=false;if(r&&r._dateMatchesVisibleRange){s=r._dateMatchesVisibleRange(e)}return s};ee.prototype.onAfterRendering=function(e){e.size={width:this.getDomRef().offsetWidth};ue.call(this,e,true);if(!this._sResizeListener){this._sResizeListener=D.register(this,this._resizeProxy)}if(f.system.phone&&this.getStickyHeader()){f.orientation.attachHandler(this._updateStickyHeader,this)}this._updateCurrentTimeVisualization(false);if(this.getHeight()){var t=this.getDomRef().querySelector("table");var a=this.$().height()-this._oInfoToolbar.$().height()-this._getTableHeaderToolbar().$().height()+"px";t.style.height=a}};ee.prototype.addToolbarContent=function(e){this.addAggregation("toolbarContent",e);le.call(this);return this};ee.prototype.insertToolbarContent=function(e,t){this.insertAggregation("toolbarContent",e,t);le.call(this);return this};ee.prototype.removeToolbarContent=function(e){var t=this.removeAggregation("toolbarContent",e);le.call(this);return t};ee.prototype.removeAllToolbarContent=function(){var e=this.removeAllAggregation("toolbarContent");le.call(this);return e};ee.prototype.destroyToolbarContent=function(){var e=this.destroyAggregation("toolbarContent");le.call(this);return e};function le(){this._getTableHeaderToolbar().setVisible(!!this.getToolbarContent().length)}ee.prototype.setStartDate=function(e){var t,a,n;if(!e){n=new Date}else{i._checkJSDateObject(e);n=new Date(e.getTime())}if(this.getViewKey()===Y.Week){t=i.getFirstDateOfWeek(i._createUniversalUTCDate(n,undefined,true));n.setTime(i._createLocalDate(t,true).getTime())}if(this.getViewKey()===Y.OneMonth||this.getViewKey()===Y.Month){a=i.getFirstDateOfMonth(i._createUniversalUTCDate(n,undefined,true));n.setTime(i._createLocalDate(a,true).getTime())}if(z(n,this.getStartDate())){this._updateTodayButtonState();return this}var r=n.getFullYear();i._checkYearInValidRange(r);var s=this.getMinDate();if(s&&s.getTime()>n.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);n=new Date(s.getTime())}else{var o=this.getMaxDate();if(o&&o.getTime()<n.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(s){n=new Date(s.getTime())}else{n=new Date(1,0,1);n.setFullYear(1)}}}this.setProperty("startDate",n,true);te.forEach(function(e){if(this[e]){this[e].setStartDate(new Date(n.getTime()))}},this);this._setRowsStartDate(new Date(n.getTime()));if(this.getViewKey()===Y.Week||this.getViewKey()===Y.OneMonth){this._updateTodayButtonState()}if(this.getDomRef()){this._updateCurrentTimeVisualization(false)}return this};ee.prototype.setMinDate=function(e){if(z(e,this.getMinDate())){return this}var t=this.getMaxDate();if(e){i._checkJSDateObject(e);var a=e.getFullYear();i._checkYearInValidRange(a);this.setProperty("minDate",e,true);this._bNoStartDateChange=true;te.forEach(function(t){if(this[t]){this[t].setMinDate(new Date(e.getTime()))}},this);if(t&&t.getTime()<e.getTime()){L.warning("minDate > maxDate -> maxDate set to end of the month",this);t=new Date(e.getTime());t.setMonth(t.getMonth()+1,0);t.setHours(23);t.setMinutes(59);t.setSeconds(59);t.setMilliseconds(0);this.setMaxDate(t)}this._bNoStartDateChange=undefined;var n=this.getStartDate();if(n&&n.getTime()<e.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);n=new Date(e.getTime());this.setStartDate(n)}}else{this.setProperty("minDate",undefined,true);te.forEach(function(e){if(this[e]){this[e].setMinDate()}},this)}var r=new Date;if(e&&r.getTime()<e.getTime()){this._oTodayButton.setVisible(false)}else if(!t||r.getTime()<t.getTime()){this._oTodayButton.setVisible(true)}return this};ee.prototype.setMaxDate=function(e){if(z(e,this.getMaxDate())){return this}var t=this.getMinDate();if(e){i._checkJSDateObject(e);var a=e.getFullYear();i._checkYearInValidRange(a);this.setProperty("maxDate",e,true);this._bNoStartDateChange=true;te.forEach(function(t){if(this[t]){this[t].setMaxDate(new Date(e.getTime()))}},this);if(t&&t.getTime()>e.getTime()){L.warning("maxDate < minDate -> maxDate set to begin of the month",this);t=new Date(e.getTime());t.setDate(1);t.setHours(0);t.setMinutes(0);t.setSeconds(0);t.setMilliseconds(0);this.setMinDate(t)}this._bNoStartDateChange=undefined;var n=this.getStartDate();if(n&&n.getTime()>e.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(t){n=new Date(t.getTime())}else{n=new Date(1,0,1);n.setFullYear(1)}this.setStartDate(n)}}else{this.setProperty("maxDate",undefined,true);te.forEach(function(e){if(this[e]){this[e].setMaxDate()}},this)}var r=new Date;if(e&&r.getTime()>e.getTime()){this._oTodayButton.setVisible(false)}else if(!t||r.getTime()>t.getTime()){this._oTodayButton.setVisible(true)}return this};ee.prototype.removeIntervalInstanceFromInfoToolbar=function(){var e=this._oInfoToolbar.getContent();e.forEach(function(e){if(e.isA(se)){this._oInfoToolbar.removeContent(e)}}.bind(this))};ee.prototype.setViewKey=function(e){var t,a,n,i=this.getViewKey(),s;this.setProperty("viewKey",e,true);this._oIntervalTypeSelect.setSelectedKey(e);this.removeIntervalInstanceFromInfoToolbar();if(e===Y.Week||e===Y.OneMonth||e===Y.Month){a=this.getStartDate();this.setStartDate(new Date(a.getTime()));if(a.getTime()!==this.getStartDate().getTime()){this.fireStartDateChange()}}var o=this.getStartDate();var l=this.getMinDate();var h=this.getMaxDate();var g=this._getView(e,!this._bBeforeRendering);if(!g){this._bCheckView=true;this.invalidate()}else{var p=g.getIntervalType();var d=this._getIntervals(g);this._bCheckView=false;switch(p){case J.Hour:if(!this._oTimeInterval){this._oTimeInterval=new c(this.getId()+"-TimeInt",{startDate:new Date(o.getTime()),items:d,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oTimeInterval);this._oTimeInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oTimeInterval.attachEvent("select",this._handleCalendarSelect,this);this._oTimeInterval._oPlanningCalendar=this;this._oTimeInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()};if(l){this._oTimeInterval.setMinDate(new Date(l.getTime()))}if(h){this._oTimeInterval.setMaxDate(new Date(h.getTime()))}}else if(this._oTimeInterval.getItems()!=d){this._oTimeInterval.setItems(d)}this._insertInterval(this._oTimeInterval);break;case J.Day:case J.Week:case J.OneMonth:n=ae[p];t=this[n.sInstanceName];if(!t){t=new n.oClass(this.getId()+n.sIdSuffix,{startDate:new Date(o.getTime()),days:d,showDayNamesLine:this.getShowDayNamesLine(),pickerPopup:true,legend:this.getLegend(),showWeekNumbers:this.getShowWeekNumbers()});this._setAriaRole(t);t.attachEvent("startDateChange",this._handleStartDateChange,this);t.attachEvent("select",this._handleCalendarSelect,this);if(e===Y.OneMonth){t._setRowsStartDate=this._setRowsStartDate.bind(this)}t._oPlanningCalendar=this;t.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()};if(l){t.setMinDate(new Date(l.getTime()))}if(h){t.setMaxDate(new Date(h.getTime()))}}else if(t.getDays()!==d){t.setDays(d)}this._insertInterval(t);this[n.sInstanceName]=t;break;case J.Month:if(!this._oMonthInterval){this._oMonthInterval=new u(this.getId()+"-MonthInt",{startDate:new Date(o.getTime()),months:d,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oMonthInterval);this._oMonthInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oMonthInterval.attachEvent("select",this._handleCalendarSelect,this);this._oMonthInterval._oPlanningCalendar=this;this._oMonthInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()};if(l){this._oMonthInterval.setMinDate(new Date(l.getTime()))}if(h){this._oMonthInterval.setMaxDate(new Date(h.getTime()))}}else if(this._oMonthInterval.setMonths()!=d){this._oMonthInterval.setMonths(d)}this._insertInterval(this._oMonthInterval);break;default:throw new Error("Unknown IntervalType: "+p+"; "+this)}var f=this.getRows();for(var v=0;v<f.length;v++){var m=f[v];var D=Ie(m);D.setIntervalType(p);D.setIntervals(d);D.setShowSubIntervals(g.getShowSubIntervals())}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);pe.call(this,this.getShowWeekNumbers(),this._viewAllowsWeekNumbers(e));de.call(this,this.getShowDayNamesLine(),!!t)}}if(this._oOneMonthInterval&&e===Y.OneMonth){this._oOneMonthInterval._setDisplayMode(this._iSize);this._oOneMonthInterval._adjustSelectedDate(r.fromLocalJSDate(a));if(this._iSize<2){this._setRowsStartDate(a)}}else if(this._oOneMonthInterval&&i===Y.OneMonth&&this._oOneMonthInterval.getSelectedDates().length){s=this._oOneMonthInterval.getSelectedDates()[0].getStartDate();if(s){this.setStartDate(s)}}this._updateTodayButtonState();return this};ee.prototype._insertInterval=function(e){if(this._iSizeScreen>1){this._oInfoToolbar.addContent(e)}else{this._oInfoToolbar.insertContent(e,1)}};ee.prototype._viewAllowsWeekNumbers=function(e){var t=this._getView(e).getIntervalType(),a=ae[t];return!!a&&!!a.oClass.prototype.setShowWeekNumbers};ee.prototype._viewAllowsDayNamesLine=function(e){var t=this._getView(e).getIntervalType(),a=ae[t];return!!a&&!!a.oClass.prototype.setShowDayNamesLine};ee.prototype._getIntervalInstanceByViewKey=function(e){var t=this._getView(e).getIntervalType(),a=ae[t],n;if(a){n=this[a.sInstanceName]}return n};ee.prototype.setShowWeekNumbers=function(e){this.setProperty("showWeekNumbers",e,true);this._getViews().forEach(function(t){var a=t.getKey(),n=this._viewAllowsWeekNumbers(a),i=this._getIntervalInstanceByViewKey(a);if(i&&n){this._getIntervalInstanceByViewKey(a).setShowWeekNumbers(e)}if(this.getDomRef()&&this.getViewKey()===a){pe.call(this,e,n)}},this);return this};ee.prototype.setShowIntervalHeaders=function(e){this.setProperty("showIntervalHeaders",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).setShowIntervalHeaders(e)}return this};ee.prototype.setShowEmptyIntervalHeaders=function(e){this.setProperty("showEmptyIntervalHeaders",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).setShowEmptyIntervalHeaders(e)}return this};ee.prototype.setGroupAppointmentsMode=function(e){this.setProperty("groupAppointmentsMode",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).setGroupAppointmentsMode(e)}return this};ee.prototype.setAppointmentsReducedHeight=function(e){this.setProperty("appointmentsReducedHeight",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).setAppointmentsReducedHeight(e)}return this};ee.prototype.setAppointmentsVisualization=function(e){this.setProperty("appointmentsVisualization",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).setAppointmentsVisualization(e)}return this};ee.prototype.setShowRowHeaders=function(e){this.setProperty("showRowHeaders",e,true);var t=this.getAggregation("table");t.getColumns()[0].setVisible(e);this._toggleAppointmentsColumnPopinState(e);this.$().toggleClass("sapMPlanCalNoHead",!e);He.call(this);Ve.call(this);return this};ee.prototype.setShowDayNamesLine=function(e){var t,a,n,i=!!this.getDomRef(),r=this.getViewKey();for(t in ae){a=ae[t].sInstanceName;if(this[a]){n=this[a];n.setShowDayNamesLine(e);if(i&&t===r){de.call(this,e,true)}}}return this.setProperty("showDayNamesLine",e,false)};ee.prototype.setStickyHeader=function(e){if(this.getStickyHeader()===e){return this}this.setProperty("stickyHeader",e,true);if(f.system.phone){if(e){f.orientation.attachHandler(this._updateStickyHeader,this)}else{f.orientation.detachHandler(this._updateStickyHeader,this)}}this._updateStickyHeader();return this};ee.prototype._updateStickyHeader=function(){var e=[],t=this.getStickyHeader(),a=this.getViewKey()===Y.OneMonth&&this._iSize<2,n=t&&!f.system.phone&&!a,i=t&&!(f.system.phone&&f.orientation.landscape)&&!a;if(n){e.push(sap.m.Sticky.HeaderToolbar)}if(this._oInfoToolbar&&i){e.push(sap.m.Sticky.InfoToolbar)}this.getAggregation("table").setSticky(e)};ee.prototype.addRow=function(e){this.addAggregation("rows",e,true);this.getAggregation("table").addItem(this._createPlanningCalendarListItem(e));return this};ee.prototype.insertRow=function(e,t){this.insertAggregation("rows",e,t);this.getAggregation("table").insertItem(this._createPlanningCalendarListItem(e),t,true);return this};ee.prototype.removeRow=function(e){var t=this.removeAggregation("rows",e,true),a=this.getAggregation("table");a.removeItem(Ce(t),true);this._handleRowRemoval(t);Pe.call(this);Ve.call(this);return t};ee.prototype.removeAllRows=function(){var e=this.removeAllAggregation("rows",true),t=this.getAggregation("table");t.removeAllItems(true);e.forEach(this._handleRowRemoval,this);Pe.call(this);Ve.call(this);return e};ee.prototype.destroyRows=function(){var e;var t=this.getAggregation("table");t.destroyItems(true);e=this.destroyAggregation("rows");Pe.call(this);Ve.call(this);return e};ee.prototype.setSingleSelection=function(e){this.setProperty("singleSelection",e,true);He.call(this);Ve.call(this);if(e){this.selectAllRows(false)}else{Pe.call(this)}this.$().toggleClass("sapMPlanCalMultiSel",!e);return this};ee.prototype.setNoDataText=function(e){this.setProperty("noDataText",e,true);var t=this.getAggregation("table");t.setNoDataText(e);return this};ee.prototype.setLegend=function(e){this.setAssociation("legend",e,true);var t=this.getRows(),n=this.getLegend()&&sap.ui.getCore().byId(this.getLegend()),i;for(var r=0;r<t.length;r++){var s=t[r];Ie(s).setLegend(e)}te.forEach(function(t){if(this[t]){this[t].setLegend(e)}},this);if(n){i=new a(function(e){this.invalidate()}.bind(this));i.observe(n,{destroy:true})}return this};ee.prototype.addAriaLabelledBy=function(e){this.addAssociation("ariaLabelledBy",e,true);var t=this.getAggregation("table");t.addAriaLabelledBy(e);return this};ee.prototype.removeAriaLabelledBy=function(e){this.removeAssociation("ariaLabelledBy",e,true);var t=this.getAggregation("table");t.removeAriaLabelledBy(e);return this};ee.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);var e=this.getAggregation("table");e.removeAllAriaLabelledBy();e.addAriaLabelledBy(this.getId()+"-Descr");return this};ee.prototype.invalidate=function(t){var a=t&&t instanceof s;if(!this._bIsBeingDestroyed&&(this._bDateRangeChanged||a)){if(this.getDomRef()){var n=this.getViewKey();var i=this._getView(n);var r=i.getIntervalType();switch(r){case J.Hour:if(this._oTimeInterval){this._oTimeInterval.invalidate(arguments)}break;case J.Day:if(this._oDateInterval){this._oDateInterval.invalidate(arguments)}break;case J.Month:if(this._oMonthInterval){this._oMonthInterval.invalidate(arguments)}break;case J.OneMonth:if(this._oOneMonthInterval){this._oOneMonthInterval.invalidate(arguments)}break;case J.Week:if(this._oWeekInterval){this._oWeekInterval.invalidate(arguments)}break;default:throw new Error("Unknown IntervalType: "+r+"; "+this)}}this._bDateRangeChanged=undefined}else{if(t&&t instanceof sap.m.PlanningCalendarView){this._bCheckView=true}e.prototype.invalidate.apply(this,arguments)}};ee.prototype.addSpecialDate=function(t){this._bDateRangeChanged=true;return e.prototype.addAggregation.call(this,"specialDates",t)};ee.prototype.insertSpecialDate=function(t,a){this._bDateRangeChanged=true;return e.prototype.insertAggregation.call(this,"specialDates",t,a)};ee.prototype.removeSpecialDate=function(t){this._bDateRangeChanged=true;return e.prototype.removeAggregation.call(this,"specialDates",t)};ee.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;return this.removeAllAggregation("specialDates")};ee.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;return this.destroyAggregation("specialDates")};ee.prototype.removeAllViews=function(){this._bCheckView=true;var e=this.removeAllAggregation("views"),t=this.getBuiltInViews();if(t.length){this.setViewKey(t[0])}else{this.setViewKey(ie[0])}return e};ee.prototype.destroyViews=function(){this._bCheckView=true;var e=this.destroyAggregation("views"),t=this.getBuiltInViews();if(t.length){this.setViewKey(t[0])}else{this.setViewKey(ie[0])}return e};ee.prototype.getSelectedRows=function(){return this.getRows().filter(function(e){return e.getSelected()})};ee.prototype.selectAllRows=function(e){var t=this.getRows();if(!(e&&this.getSingleSelection())){for(var a=0;a<t.length;a++){var n=t[a];n.setSelected(e)}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.setSelected(e)}}return this};ee.prototype.onsaphomemodifiers=function(e){if((e.metaKey||e.ctrlKey)&&!e.altKey&&!e.shiftKey){var t=this.getRows();var a=t[0];var n=new B.Event("saphome");n._bPlanningCalendar=true;Ie(a).onsaphome(n);e.preventDefault();e.stopPropagation()}};ee.prototype.onsapendmodifiers=function(e){if((e.metaKey||e.ctrlKey)&&!e.altKey&&!e.shiftKey){var t=this.getRows();var a=t[t.length-1];var n=new B.Event("sapend");n._bPlanningCalendar=true;Ie(a).onsapend(n);e.preventDefault();e.stopPropagation()}};ee.prototype.setBuiltInViews=function(e){this.setProperty("builtInViews",e);this.setViewKey(this._getViews()[0].getKey());return this};ee.prototype.removeView=function(e){var t=this.removeAggregation("views",e);if(!this.getViews().length){this.setViewKey(this._getViews()[0].getKey())}return t};ee.prototype._getIntervals=function(e){var t=0;switch(this._iSize){case 0:t=e.getIntervalsS();break;case 1:t=e.getIntervalsM();break;default:t=e.getIntervalsL();break}return t};ee.prototype._getView=function(e,t){var a=this._getViews();var n;for(var i=0;i<a.length;i++){n=a[i];if(n.getKey()!=e){n=undefined}else{break}}if(!n&&!t){throw new Error("PlanningCalendarView with key "+e+"not assigned "+this)}return n};ee.prototype._changeStartDate=function(e){if(this._bNoStartDateChange){return}this.setStartDate(new Date(e.getTime()));this.fireStartDateChange()};ee.prototype._updateCurrentTimeVisualization=function(e){if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}if(e){var t=this.getRows();for(var a=0;a<t.length;a++){var n=t[a];Ie(n).updateCurrentTimeVisualization()}}var i=new Date;var r=this.getStartDate();var s=this.getViewKey();var o=this._getView(s);var l=o.getIntervalType();var h=this._getIntervals(o);var g=0;var p=0;var d=0;switch(l){case J.Hour:g=6e4;p=r.getTime()-36e5;d=r.getTime()+h*36e5;break;case J.Day:case J.Week:case J.OneMonth:g=18e5;p=r.getTime()-36e5;d=r.getTime()+h*864e5;break;default:g=-1;break}if(i.getTime()<=d&&i.getTime()>=p&&g>0){this._sUpdateCurrentTime=setTimeout(this["_updateCurrentTimeVisualization"].bind(this,true),g)}};function he(e){this.setViewKey(e.getParameter("selectedItem").getKey());this.fireViewChange()}ee.prototype._handleTodayPress=function(e){var t=new Date,a,n=this.getViewKey();if(n===Y.OneMonth){a=i.getFirstDateOfMonth(i._createUniversalUTCDate(t,undefined,true));this._oOneMonthInterval._adjustSelectedDate(r.fromLocalJSDate(t),false);t=i._createLocalDate(a,true)}if(n===Y.Week){a=this.getStartDate();t.setHours(a.getHours());t.setMinutes(a.getMinutes());t.setSeconds(a.getSeconds())}this.setStartDate(t);this.fireStartDateChange()};ee.prototype._handleStartDateChange=function(e){var t=e.oSource.getStartDate();if(this._getView(this.getViewKey()).getIntervalType()!==J.Hour){var a=this.getStartDate();t.setHours(a.getHours());t.setMinutes(a.getMinutes());t.setSeconds(a.getSeconds())}this._changeStartDate(t)};ee.prototype._handleCalendarSelect=function(e){var t=e.oSource.getSelectedDates();if(!t.length){return}var a=new Date(t[0].getStartDate());var n=i._createUniversalUTCDate(a,undefined,true);var s=this.getViewKey();var o=this._getView(s);var l=o.getIntervalType();if(l!==J.OneMonth||this._iSize>1){t[0].setStartDate()}switch(l){case J.Hour:n.setUTCHours(n.getUTCHours()+1);break;case J.Day:case J.Week:n.setUTCDate(n.getUTCDate()+1);break;case J.OneMonth:if(this._iSize<2){var h=new Date(a.getTime());if(i.monthsDiffer(this.getStartDate(),a)){this.setStartDate(a)}this._setRowsStartDate(h);this._oOneMonthInterval.getAggregation("month")[0]._focusDate(r.fromLocalJSDate(h),true)}else if(i._isNextMonth(a,this.getStartDate())){this._oOneMonthInterval._handleNext();return}n.setUTCDate(n.getUTCDate()+1);break;case J.Month:n.setUTCMonth(n.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+l+"; "+this)}n.setUTCMilliseconds(n.getUTCMilliseconds()-1);n=i._createLocalDate(n,true);this.fireIntervalSelect({startDate:a,endDate:n,subInterval:false,row:undefined})};function ge(e){var t=e.getParameter("startDate");var a=this.getViewKey();var n=this._getView(a);var r=n.getIntervalType();if(r===J.OneMonth&&i._isNextMonth(t,this.getStartDate())){this._oOneMonthInterval._handleNext();return}var s=e.getParameter("endDate");var o=e.getParameter("subInterval");var l=_e(e.oSource.getParent());this.fireIntervalSelect({startDate:t,endDate:s,subInterval:o,row:l})}ee.prototype._applyContextualSettings=function(a){return e.prototype._applyContextualSettings.call(this,a||t._defaultContextualSettings)};ee.prototype._getTableHeaderToolbar=function(){return this.getAggregation("table").getHeaderToolbar()};function pe(e,t){this.$().toggleClass("sapMPlanCalWithWeekNumbers",e&&t)}function de(e,t){this.$().toggleClass("sapMPlanCalWithDayNamesLine",e&&t)}function ue(e,t){if(e.size.width<=0){return}if(Math.abs(this.iWidth-e.size.width)<15){return}this.iWidth=e.size.width;this._applyContextualSettings({contextualWidth:this.iWidth});var a=this.getRows();var n;var i=0;var r=this._iSize;Ae.call(this,e.size.width);if(r!=this._iSize){be.call(this,this._iSize);var s=this.getViewKey();var o=this._getView(s);var l=o.getIntervalType();var h=this._getIntervals(o);for(i=0;i<a.length;i++){n=a[i];var g=Ie(n);if(h!=g.getIntervals()){g.setIntervals(h)}else{g.handleResize()}}switch(l){case J.Hour:if(this._oTimeInterval&&this._oTimeInterval.getItems()!=h){this._oTimeInterval.setItems(h)}break;case J.Day:if(this._oDateInterval&&this._oDateInterval.getDays()!=h){this._oDateInterval.setDays(h)}break;case J.Month:if(this._oMonthInterval&&this._oMonthInterval.getMonths()!=h){this._oMonthInterval.setMonths(h)}break;case J.Week:if(this._oWeekInterval&&this._oWeekInterval.getDays()!=h){this._oWeekInterval.setDays(h)}break;case J.OneMonth:if(this._oOneMonthInterval&&this._oOneMonthInterval.getDays()!=h){this._oOneMonthInterval.setDays(h);if(this._iSize>1){this._setRowsStartDate(new Date(this.getStartDate().getTime()))}}break;default:throw new Error("Unknown IntervalType: "+l+"; "+this)}He.call(this)}else if(!t){for(i=0;i<a.length;i++){n=a[i];Ie(n).handleResize()}}if(this._oOneMonthInterval){this._oOneMonthInterval._setDisplayMode(this._iSize)}if(this.getStickyHeader()){this._updateStickyHeader()}}function ce(e){var t=e.getParameter("appointment"),a=e.getParameter("multiSelect"),n=e.getParameter("appointments"),i=e.getParameter("domRefId"),r,s,o,l,h,g,p;if(!a){s=this.getRows();for(g=0;g<s.length;g++){o=s[g];if(e.oSource!=Ie(o)){l=o.getAppointments();for(p=0;p<l.length;p++){h=l[p];h.setSelected(false)}}}}r={appointment:t,appointments:n,multiSelect:a,domRefId:i};this.fireAppointmentSelect(r)}ee.prototype._setRowsStartDate=function(e){var t=this.getRows(),a,n;for(n=0;n<t.length;n++){a=t[n];Ie(a).setStartDate(e)}};ee.prototype._toggleAppointmentsColumnPopinState=function(e){var t=this.getAggregation("table"),a=t.getColumns()[1];a.setDemandPopin(e);a.setMinScreenWidth(e?ne:"")};ee.prototype._getViews=function(){var e=this.getViews(),t=this.getBuiltInViews(),a,n=[],i=Y,r=J;if(!this._oViews){this._oViews={}}if(t.length){n=t}else{n=e.length?[]:ie}a=n.map(function(e){switch(e){case i.Hour:return this._oViews[i.Hour]||(this._oViews[i.Hour]=new E(this.getId()+"-HourView",{key:i.Hour,intervalType:r.Hour,description:this._oRB.getText("PLANNINGCALENDAR_HOURS"),intervalsS:6,intervalsM:6,intervalsL:12}));case i.Day:return this._oViews[i.Day]||(this._oViews[i.Day]=new E(this.getId()+"-DayView",{key:i.Day,intervalType:r.Day,description:this._oRB.getText("PLANNINGCALENDAR_DAYS"),intervalsS:7,intervalsM:7,intervalsL:14}));case i.Month:return this._oViews[i.Month]||(this._oViews[i.Month]=new E(this.getId()+"-MonthView",{key:i.Month,intervalType:r.Month,description:this._oRB.getText("PLANNINGCALENDAR_MONTHS"),intervalsS:3,intervalsM:6,intervalsL:12}));case i.Week:return this._oViews[i.Week]||(this._oViews[i.Week]=new E(this.getId()+"-WeekView",{key:i.Week,intervalType:r.Week,description:this._oRB.getText("PLANNINGCALENDAR_WEEK"),intervalsS:7,intervalsM:7,intervalsL:7}));case i.OneMonth:return this._oViews[i.OneMonth]||(this._oViews[i.OneMonth]=new E(this.getId()+"-OneMonthView",{key:i.OneMonth,intervalType:r.OneMonth,description:this._oRB.getText("PLANNINGCALENDAR_ONE_MONTH"),intervalsS:1,intervalsM:1,intervalsL:31}));default:L.error("Cannot get PlanningCalendar views. Invalid view key "+e);break}},this);for(var s in this._oViews){if(n.indexOf(s)<0){this._oViews[s].destroy();delete this._oViews[s]}}if(e.length){a=a.concat(e)}return a};ee.prototype.getSelectedAppointments=function(){var e=[];this.getRows().filter(function(t){e.push.apply(e,Ie(t).aSelectedAppointments)});return e};ee.prototype.setCustomAppointmentsSorterCallback=function(e){if(typeof e==="function"||e===null||e===undefined){this.getRows().forEach(function(t){Ie(t)._setCustomAppointmentsSorterCallback(e)});this._fnCustomSortedAppointments=e}else{L.warning("Your custom sort function won't be used, but the old one will be preserved.",this)}return this};ee.prototype.getCustomAppointmentsSorterCallback=function(){return this._fnCustomSortedAppointments};ee.prototype._onRowDeselectAppointment=function(){var e=this.getRows();for(var t=0;t<e.length;t++){var a=Ie(e[t]).aSelectedAppointments;for(var n=0;n<a.length;n++){var i=sap.ui.getCore().byId(a[n]);if(i){i.setProperty("selected",false,true);i.$().removeClass("sapUiCalendarAppSel")}}Ie(e[t]).aSelectedAppointments=[]}};ee.prototype._updateRowTimeline=function(e){var t=Ie(e),a,n,i,r,s=this.getViewKey()===Y.OneMonth&&this._iSize<2,o=this.getStartDate();t.setNonWorkingDays(e.getNonWorkingDays());t.setNonWorkingHours(e.getNonWorkingHours());if(s&&this._oOneMonthInterval&&this._oOneMonthInterval.getSelectedDates().length){o=this._oOneMonthInterval.getSelectedDates()[0].getStartDate()}t.setStartDate(o);t.setShowIntervalHeaders(this.getShowIntervalHeaders());t.setShowEmptyIntervalHeaders(this.getShowEmptyIntervalHeaders());t.setGroupAppointmentsMode(this.getGroupAppointmentsMode());t.setAppointmentsReducedHeight(this.getAppointmentsReducedHeight());t.setLegend(this.getLegend());t.setAppointmentsVisualization(this.getAppointmentsVisualization());t.attachEvent("select",ce,this);t.attachEvent("startDateChange",this._handleStartDateChange,this);t.attachEvent("leaveRow",ke,this);t.attachEvent("intervalSelect",ge,this);Pe.call(this);if(Ne.call(this)){a=this.getViewKey();n=this._getView(a);i=n.getIntervalType();r=this._getIntervals(n);t.setIntervalType(i);t.setIntervals(r);t.setShowSubIntervals(n.getShowSubIntervals())}Ve.call(this);if(this._fnCustomSortedAppointments){t._setCustomAppointmentsSorterCallback(this._fnCustomSortedAppointments)}};ee.prototype._observeRowChanges=function(e){var t=Ce(e),n=Se(e),i=Ie(e);var r={destroy:function(){t.destroy()},change:{title:function(e){n.setProperty(e.name,e.current)},icon:function(e){n.setProperty(e.name,e.current)},text:function(e){i.toggleStyleClass("sapMPlanCalRowLarge",!!e.current);n.setProperty("description",e.current)},enableAppointmentsDragAndDrop:function(t){this._enableAppointmentsDragAndDrop(e)}.bind(this),enableAppointmentsResize:function(t){this._enableAppointmentsResize(e)}.bind(this),enableAppointmentsCreate:function(t){this._enableAppointmentsCreate(e)}.bind(this),nonWorkingDays:function(e){i.setProperty(e.name,e.current)},nonWorkingHours:function(e){i.setProperty(e.name,e.current)},selected:function(e){Pe.call(this);t.setProperty(e.name,e.current)}.bind(this),tooltip:function(e){if(e.mutation==="insert"){n.setTooltip(e.child)}else if(e.mutation==="remove"){n.setTooltip()}},intervalHeaders:function(e){i.invalidate()},appointments:function(e){i.invalidate()}}};new a(function(e){if(e.type==="destroy"){r.destroy()}else if(r.change[e.name]){r.change[e.name](e)}}).observe(e,{properties:["icon","text","title","nonWorkingDays","nonWorkingHours","selected","enableAppointmentsDragAndDrop","enableAppointmentsResize","enableAppointmentsCreate"],aggregations:["tooltip","appointments","intervalHeaders","headerContent"],destroy:true});e.invalidate=function(e){if(!e||!(e instanceof o)){v.prototype.invalidate.apply(this,arguments)}else if(t){i.invalidate(e)}};e.applyFocusInfo=function(e){i.applyFocusInfo(e);return this}};ee.prototype._createPlanningCalendarListItem=function(e){var t,a,n;if(e.getHeaderContent().length||e.getBindingInfo("headerContent")){a=e._getPlanningCalendarCustomRowHeader()}else{a=new fe(e.getId()+"-Head",{icon:e.getIcon(),description:e.getText(),title:e.getTitle(),tooltip:e.getTooltip()})}n=new me(e.getId()+"-CalRow",{checkResize:false,updateCurrentTime:false,ariaLabelledBy:a.getId()});n.getAppointments=function(){return e.getAppointments()};n.getIntervalHeaders=function(){return e.getIntervalHeaders()};t=new we(e.getId()+Z,{cells:[a,n]});this._updateRowTimeline(e);this._observeRowChanges(e);this._enableAppointmentsDragAndDrop(e);this._enableAppointmentsResize(e);this._enableAppointmentsCreate(e);return t};ee.prototype._handleRowRemoval=function(e){var t=Ie(e);t.detachEvent("select",ce,this);t.detachEvent("startDateChange",this._handleStartDateChange,this);t.detachEvent("leaveRow",ke,this);t.detachEvent("intervalSelect",ge,this);if(this._fnCustomSortedAppointments){t._fnCustomSortedAppointments=undefined}Ce(e).destroy()};var fe=P.extend("PlanningCalendarRowHeader",{renderer:m.extend(H)});PlanningCalendarRowHeaderRenderer.openItemTag=function(e,t){e.write("<div")};PlanningCalendarRowHeaderRenderer.closeItemTag=function(e,t){e.write("</div>")};PlanningCalendarRowHeaderRenderer.renderTabIndex=function(e,t){};PlanningCalendarRowHeaderRenderer.getAriaRole=function(e,t){};var ve=m.extend(h);ve.getLegendItems=function(e){var t=[],a,n=e.getLegend();if(n){a=sap.ui.getCore().byId(n);if(a){t=a.getAppointmentItems?a.getAppointmentItems():a.getItems()}else{L.error("PlanningCalendarLegend with id '"+n+"' does not exist!",e)}}return t};ve.renderBeforeAppointments=function(e,t){var a=_e(t.getParent()),n;if(!a.getEnableAppointmentsDragAndDrop()&&!a.getEnableAppointmentsResize()&&!a.getEnableAppointmentsCreate()||t._isOneMonthIntervalOnSmallSizes()){return}n=t.getAggregation("_intervalPlaceholders");e.write('<div class="sapUiCalendarRowAppsOverlay">');if(n){for(var i=0;i<n.length;i++){var r=n[i];r.setWidth(100/n.length+"%");e.renderControl(r)}}e.write("</div>")};ve.renderResizeHandle=function(e,t,a){if(!_e(t.getParent()).getEnableAppointmentsResize()||t._isOneMonthIntervalOnSmallSizes()||a._aAppointments&&a._aAppointments.length>0){return}e.write("<span");e.addClass("sapUiCalendarAppResizeHandle");e.writeClasses();e.write(">");e.write("</span>")};ve.writeCustomAttributes=function(e,t){if(_e(t.getParent()).getEnableAppointmentsCreate()){e.writeAttribute("draggable","true")}};ve.renderInterval=function(e,t,a,n,i,r,s,o,l,g,p,d,u){var c=t.getIntervalType();if(c===J.Day||c===J.Week||c===J.OneMonth){var f=_e(t.getParent()),v=f.getParent(),m=function(e){return e.getType()===W.NonWorking},D=f.getSpecialDates().filter(m),w=v.getSpecialDates().filter(m),y=t.getStartDate(),_,C,S,I;if(w&&D){_=w.concat(D)}else if(D){_=D}if(_&&_.length){var T=function(e){return e===C.getDay()};C=new Date(y.getTime());C.setHours(0,0,0);C.setDate(y.getDate()+a);for(var A=0;A<_.length;A++){if(_[A].getStartDate()){S=new Date(_[A].getStartDate().getTime())}if(_[A].getEndDate()){I=new Date(_[A].getEndDate().getTime())}else{I=new Date(_[A].getStartDate().getTime());I.setHours(23,59,59)}if(C.getTime()>=S.getTime()&&C.getTime()<=I.getTime()){var b=r.some(T);if(!b){e.addClass("sapUiCalendarRowAppsNoWork")}}}}}h.renderInterval(e,t,a,n,i,r,s,o,l,g,p,d,u)};var me=l.extend("PlanningCalendarRowTimeline",{metadata:{aggregations:{intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true},_intervalPlaceholders:{type:"IntervalPlaceholder",multiple:true,visibility:"hidden",dnd:{droppable:true}}},dnd:true},renderer:ve});me.prototype._updatePlaceholders=function(){var e=this.getProperty("intervals");if(this.getIntervalType()===J.Hour){e*=2}this.removeAllAggregation("_intervalPlaceholders");for(var t=0;t<e;t++){this.addAggregation("_intervalPlaceholders",new De)}};me.prototype.onBeforeRendering=function(){l.prototype.onBeforeRendering.call(this);this._updatePlaceholders()};me.prototype.onmousedown=function(e){var t=e.target.classList;this._isResizeHandleMouseDownTarget=t.contains("sapUiCalendarAppResizeHandle");this._isRowAppsIntervalMouseDownTarget=t.contains("sapUiCalendarRowAppsInt")};me.prototype._isResizingPerformed=function(){return this._isResizeHandleMouseDownTarget};me.prototype._isDraggingPerformed=function(){return!this._isResizeHandleMouseDownTarget&&!this._isRowAppsIntervalMouseDownTarget};me.prototype._isCreatingPerformed=function(){return this._isRowAppsIntervalMouseDownTarget};var De=e.extend("IntervalPlaceholder",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}},renderer:function(e,t){e.write("<div");e.writeControlData(t);e.addStyle("width",t.getWidth());e.writeStyles();e.addClass("sapUiCalendarRowAppsPlaceholder");e.writeClasses();e.write("></div>")}});var we=R.extend("sap.m.internal.PlanningCalendarRowListItem",{metadata:{library:"sap.m"},renderer:k});we.prototype.getHeader=function(){return this.getCells()[0]};we.prototype.getTimeline=function(){return this.getCells()[1]};we.prototype.getCustomData=function(){return _e(this).getCustomData()};ee.prototype._getSelectedDates=function(){var e=this.getViewKey(),t=this._getView(e),a=t.getIntervalType(),n=ae[a];return this[n.sInstanceName].getSelectedDates()};ee.prototype._enableAppointmentsDragAndDrop=function(e){var t=Ie(e),a;if(e.getEnableAppointmentsDragAndDrop()){a=e.getDragDropConfig().some(function(e){return e.getGroupName()===q});if(!a){this._addDragDropInfo(e,Ie(e))}}else{e.getDragDropConfig().forEach(function(t){if(t.getGroupName()===q){e.removeDragDropConfig(t)}});t.getDragDropConfig().forEach(function(e){if(e.getGroupName()===q){t.removeDragDropConfig(e)}})}};ee.prototype._enableAppointmentsResize=function(e){var t=e.getEnableAppointmentsResize(),a=this._getConfigFromDragDropConfigAggregation(e.getAggregation("dragDropConfig"),X),n=this._getResizeConfig(e);if(t&&!a){e.addAggregation("dragDropConfig",n,true)}if(!t){e.removeAggregation("dragDropConfig",a,true)}};ee.prototype._enableAppointmentsCreate=function(e){var t=e.getEnableAppointmentsCreate(),a=Ie(e),n=this._getConfigFromDragDropConfigAggregation(a.getAggregation("dragDropConfig"),Q),i=this._getAppointmentsCreateConfig(e);if(t&&!n){a.addAggregation("dragDropConfig",i,true)}if(!t){a.removeAggregation("dragDropConfig",n,true)}};ee.prototype._addDragDropInfo=function(e,t){e.addDragDropConfig(new y({groupName:q,sourceAggregation:"appointments",dragStart:function(e){var a=function(){var e=B(".sapUiCalendarRowAppsOverlay");setTimeout(function(){e.addClass("sapUiCalendarRowAppsOverlayDragging")},0);B(document).one("dragend",function(){e.removeClass("sapUiCalendarRowAppsOverlayDragging")})};if(t._isOneMonthIntervalOnSmallSizes()||!t._isDraggingPerformed()){e.preventDefault();return}a()}}));t.addDragDropConfig(new _({groupName:q,targetAggregation:"_intervalPlaceholders",dragEnter:function(a){var n=a.getParameter("dragSession"),i=n.getDragControl(),r=t.getIntervalType(),s=t.getStartDate(),o=t.indexOfAggregation("_intervalPlaceholders",n.getDropControl()),l=t.getId(),h,g=function(){var e=B(n.getIndicator()),t=n.getDropControl().getDomRef().getBoundingClientRect(),a=sap.ui.getCore().byId(l).getDomRef().getBoundingClientRect(),i=n.getDragControl().$().outerWidth(),r=sap.ui.getCore().getConfiguration().getRTL(),s=r?Math.ceil(t.right)-a.left:a.right-Math.ceil(t.left);e.css("min-width",i<s?i:s).css(r?"border-left-width":"border-right-width",i>s?"0":"").css("margin-left",r?-(e.outerWidth()-parseFloat(e.context.style.width)):"")};if(e.hasListeners("appointmentDragEnter")){if(r===J.Hour){h=this._calcNewHoursAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Day||r===J.Week||r===J.OneMonth&&!t._isOneMonthIntervalOnSmallSizes()){h=this._calcNewDaysAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Month){h=this._calcNewMonthsAppPos(s,i.getStartDate(),i.getEndDate(),o)}var p=e.fireAppointmentDragEnter({appointment:i,startDate:h.startDate,endDate:h.endDate,calendarRow:_e(t.getParent())});if(!p){a.preventDefault();return}}else if(Ie(i.getParent())!==t){a.preventDefault();return}if(t.getIntervalType()!==J.Hour){return}if(!n.getIndicator()){setTimeout(g,0)}else{g()}}.bind(this),drop:function(a){var n=a.getParameter("dragSession"),i=n.getDragControl(),r=t.getIntervalType(),s=t.getStartDate(),o=t.indexOfAggregation("_intervalPlaceholders",n.getDropControl()),l,h=a.getParameter("browserEvent"),g=h.metaKey||h.ctrlKey;if(r===J.Hour){l=this._calcNewHoursAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Day||r===J.Week||r===J.OneMonth&&!t._isOneMonthIntervalOnSmallSizes()){l=this._calcNewDaysAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Month){l=this._calcNewMonthsAppPos(s,i.getStartDate(),i.getEndDate(),o)}t.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");if(i.getStartDate().getTime()===l.startDate.getTime()&&i.getParent()===_e(t.getParent())){return}e.fireAppointmentDrop({appointment:i,startDate:l.startDate,endDate:l.endDate,calendarRow:_e(t.getParent()),copy:g})}.bind(this)}))};ee.prototype._calcNewHoursAppPos=function(e,t,a,n){var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());i=new Date(i.getTime()+n*30*60*1e3);return{startDate:i,endDate:new Date(i.getTime()+a.getTime()-t.getTime())}};ee.prototype._calcNewDaysAppPos=function(e,t,a,n){var i=new Date(e);i.setDate(i.getDate()+n);i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:i,endDate:new Date(i.getTime()+a.getTime()-t.getTime())}};ee.prototype._calcNewMonthsAppPos=function(e,t,a,n){var i=new Date(e);i.setMonth(i.getMonth()+n);i=new Date(i.getFullYear(),i.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:i,endDate:new Date(i.getTime()+a.getTime()-t.getTime())}};ee.prototype._getResizeConfig=function(e){var t=Ie(e),a=new C({sourceAggregation:"appointments",targetAggregation:"_intervalPlaceholders",targetElement:Ie(e),dragStart:function(a){if(!e.getEnableAppointmentsResize()||t._isOneMonthIntervalOnSmallSizes()||!t._isResizingPerformed()){a.preventDefault();return}var n=a.getParameter("dragSession"),i=t.$().find(".sapUiCalendarRowAppsOverlay"),r=B(n.getIndicator()),s=n.getDragControl().$();r.addClass("sapUiDnDIndicatorHide");setTimeout(function(){i.addClass("sapUiCalendarRowAppsOverlayDragging")},0);B(document).one("dragend",function(){i.removeClass("sapUiCalendarRowAppsOverlayDragging");r.removeClass("sapUiDnDIndicatorHide");s.css({width:"auto","min-width":"auto","z-index":"auto",opacity:1})});if(!f.browser.msie&&!f.browser.edge){a.getParameter("browserEvent").dataTransfer.setDragImage(ye(),0,0)}},dragEnter:function(e){var t=e.getParameter("dragSession"),a=this.getTargetElement(),n=function(){var e=B(t.getIndicator());e.addClass("sapUiDnDIndicatorHide")},i=t.getDropControl().getDomRef().getBoundingClientRect(),r=sap.ui.getCore().byId(a).getDomRef().getBoundingClientRect(),s={width:i.left+i.width-(t.getDragControl().$().position().left+r.left),"min-width":Math.min(t.getDragControl().$().outerWidth(),t.getDropControl().$().outerWidth()),"z-index":1,opacity:.8};t.getDragControl().$().css(s);if(!t.getIndicator()){setTimeout(n,0)}else{n()}},drop:function(t){var a=Ie(e),n=t.getParameter("dragSession"),i=n.getDragControl(),r=a.getIntervalType(),s=a.getStartDate(),o=a.indexOfAggregation("_intervalPlaceholders",n.getDropControl()),l;if(r===J.Hour){l=this._calcResizeNewHoursAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Day||r===J.Week||r===J.OneMonth&&!a._isOneMonthIntervalOnSmallSizes()){l=this._calcResizeNewDaysAppPos(s,i.getStartDate(),i.getEndDate(),o)}else if(r===J.Month){l=this._calcResizeNewMonthsAppPos(s,i.getStartDate(),i.getEndDate(),o)}a.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");B(n.getIndicator()).removeClass("sapUiDnDIndicatorHide");i.$().css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});if(i.getEndDate().getTime()===l.endDate.getTime()){return}e.fireAppointmentResize({appointment:i,startDate:l.startDate,endDate:l.endDate,calendarRow:e})}.bind(this)});a.setProperty("groupName",X);return a};ee.prototype._calcResizeNewHoursAppPos=function(e,t,a,n){var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),r=30*60*1e3;i=new Date(i.getTime()+(n+1)*r);if(i.getTime()<=t.getTime()){i=new Date(t.getTime()+r)}return{startDate:t,endDate:i}};ee.prototype._calcResizeNewDaysAppPos=function(e,t,a,n){var i=new Date(e),r=i.getDate()+n+1;if(r<=t.getDate()){r=t.getDate()+1}i.setDate(r);i=new Date(i.getFullYear(),i.getMonth(),i.getDate());return{startDate:t,endDate:i}};ee.prototype._calcResizeNewMonthsAppPos=function(e,t,a,n){var i=new Date(e),r=i.getMonth()+n+1;if(r<=t.getMonth()){r=t.getMonth()+1}i.setMonth(r);i=new Date(i.getFullYear(),i.getMonth(),1);return{startDate:t,endDate:i}};ee.prototype._calcCreateNewAppHours=function(e,t,a){var n=30*60*1e3,i,r;if(t<=a){i=new Date(e.getTime()+t*n);r=new Date(e.getTime()+(a+1)*n)}else{i=new Date(e.getTime()+a*n);r=new Date(e.getTime()+t*n)}return{startDate:i,endDate:r}};ee.prototype._calcCreateNewAppDays=function(e,t,a){var n=new Date(e),i=new Date(e);if(t<=a){n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a+1)}else{n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a);i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)}return{startDate:n,endDate:i}};ee.prototype._calcCreateNewAppMonths=function(e,t,a){var n=new Date(e),i=new Date(e);if(t<=a){n=new Date(e.getFullYear(),e.getMonth()+t,1);i=new Date(e.getFullYear(),e.getMonth()+a+1,1)}else{n=new Date(e.getFullYear(),e.getMonth()+a,1);i=new Date(e.getFullYear(),e.getMonth()+t,1)}return{startDate:n,endDate:i}};ee.prototype._getConfigFromDragDropConfigAggregation=function(e,t){var a=e,n=a&&a.length;for(var i=0;i<n;i++){if(a[i].getGroupName()===t){return a[i]}}return null};ee.prototype._getAppointmentsCreateConfig=function(e){var t=Ie(e),a=new C({targetAggregation:"_intervalPlaceholders",dragStart:function(a){if(!e.getEnableAppointmentsCreate()||t._isOneMonthIntervalOnSmallSizes()||!t._isCreatingPerformed()){a.preventDefault();return}var n=a.getParameter("dragSession"),i=t.$().find(".sapUiCalendarRowAppsOverlay"),r=B(n.getIndicator());setTimeout(function(){i.addClass("sapUiCalendarRowAppsOverlayDragging")},0);B(document).one("dragend",function(){i.removeClass("sapUiCalendarRowAppsOverlayDragging");r.html("");r.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")});if(!f.browser.msie&&!f.browser.edge){a.getParameter("browserEvent").dataTransfer.setDragImage(ye(),0,0)}},dragEnter:function(e){var a=e.getParameter("dragSession"),n=a.getDropControl().getDomRef().getBoundingClientRect(),i=function(){var e=B(a.getIndicator());e.addClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")};var r=a.getData("text")?parseFloat(a.getData("text").split("|")[0]):0;if(r){if(r<=n.left){a.setIndicatorConfig({left:r,width:Math.max(n.left+n.width-r,n.width)})}else{a.setIndicatorConfig({left:n.left,width:r-n.left})}}else{a.setData("text",n.left+"|"+t.indexOfAggregation("_intervalPlaceholders",a.getDropControl()))}if(!a.getIndicator()){setTimeout(i,0)}else{i()}},drop:function(a){var n=a.getParameter("dragSession"),i=B(n.getIndicator()),r=t.getIntervalType(),s=Ie(e).getStartDate(),o=parseInt(n.getData("text").split("|")[1]),l=t.indexOfAggregation("_intervalPlaceholders",n.getDropControl()),h;if(r===J.Hour){h=this._calcCreateNewAppHours(s,o,l)}else if(r===J.Day||r===J.Week||r===J.OneMonth&&!t._isOneMonthIntervalOnSmallSizes()){h=this._calcCreateNewAppDays(s,o,l)}else if(r===J.Month){h=this._calcCreateNewAppMonths(s,o,l)}e.fireAppointmentCreate({startDate:h.startDate,endDate:h.endDate,calendarRow:e});i.html("");i.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")}.bind(this)});a.setProperty("groupName",Q);return a};function ye(){var e=B("<span></span>").addClass("sapUiCalAppResizeGhost");e.appendTo(document.body);setTimeout(function(){e.remove()},0);return e.get(0)}function _e(e){var t=e.getId();return sap.ui.getCore().byId(t.substring(0,t.indexOf(Z)))}function Ce(e){return sap.ui.getCore().byId(e.getId()+Z)}function Se(e){var t=Ce(e);return t?t.getHeader():null}function Ie(e){var t=Ce(e);return t?t.getTimeline():null}function Te(e){var t=[];var a=this.getRows();for(var n=0;n<a.length;n++){var i=a[n];var r=Ce(i);var s=r.getSelected();if(i.getSelected()!=s){i.setProperty("selected",s,true);t.push(i)}}if(!this.getSingleSelection()){Pe.call(this)}if(t.length>0){this.fireRowSelectionChange({rows:t})}}function Ae(e){if(e<this._iBreakPointTablet){this._iSize=0}else if(e<this._iBreakPointDesktop){this._iSize=1}else{this._iSize=2}if(e<re.PHONE){this._iSizeScreen=0}else if(e<re.TABLET){this._iSizeScreen=1}else{this._iSizeScreen=2}}function be(e){var t="sapMSize"+e,a=this.$(),n,i;if(a){for(n=0;n<3;n++){i="sapMSize"+n;if(i===t){a.addClass(i)}else{a.removeClass(i)}}}}function Me(){var e=this._getViews();this._oIntervalTypeSelect.destroyItems();var t;var a;for(t=0;t<e.length;t++){var n=e[t];a=new w(this.getId()+"-"+t,{key:n.getKey(),text:n.getDescription(),tooltip:n.getTooltip()});this._oIntervalTypeSelect.addItem(a)}this._oIntervalTypeSelect.setVisible(!(e.length===1))}function Re(e){var t=e.getParameter("selected");var a=this.getRows();if(t){a=this.getRows().filter(function(e){return!e.getSelected()})}this.selectAllRows(t);this.fireRowSelectionChange({rows:a})}function ke(e){var t=e.oSource;var a=e.getParameter("type");var n=this.getRows();var i;var r;var s;var o;var l=0;var h=0;var g;for(l=0;l<n.length;l++){i=n[l];if(Ie(i)==t){h=l;break}}switch(a){case"sapup":s=t.getFocusedAppointment();o=s.getStartDate();if(h>0){h--}r=n[h];Ie(r).focusNearestAppointment(o);break;case"sapdown":s=t.getFocusedAppointment();o=s.getStartDate();if(h<n.length-1){h++}r=n[h];Ie(r).focusNearestAppointment(o);break;case"saphome":if(h>0){r=n[0];g=new B.Event(a);g._bPlanningCalendar=true;Ie(r).onsaphome(g)}break;case"sapend":if(h<n.length-1){r=n[n.length-1];g=new B.Event(a);g._bPlanningCalendar=true;Ie(r).onsapend(g)}break;default:break}}function Pe(){if(this._oSelectAllCheckBox){var e=this.getRows();var t=this.getSelectedRows();if(e.length==t.length&&t.length>0){this._oSelectAllCheckBox.setSelected(true)}else{this._oSelectAllCheckBox.setSelected(false)}}}function He(){if(this.getSingleSelection()){if(this._oCalendarHeader.getAllCheckBox()){this._oCalendarHeader.setAllCheckBox()}else if(this._oInfoToolbar.getContent().length>2){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox)}}else{if(!this._oSelectAllCheckBox){this._oSelectAllCheckBox=new O(this.getId()+"-All",{text:this._oRB.getText("COLUMNSPANEL_SELECT_ALL")});this._oSelectAllCheckBox.attachEvent("select",Re,this)}if(this._iSizeScreen<2||!this.getShowRowHeaders()){var e=this._oInfoToolbar.indexOfContent(this._oSelectAllCheckBox);if(this._iSizeScreen<2){if(e<this._oInfoToolbar.getContent().length-1){this._oInfoToolbar.addContent(this._oSelectAllCheckBox)}}else if(e<0||e>1){if(e>1){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox)}this._oInfoToolbar.insertContent(this._oSelectAllCheckBox,1)}}else{this._oCalendarHeader.setAllCheckBox(this._oSelectAllCheckBox)}}}function Ve(){var e=this.getAggregation("table");var t=e.getMode();var a;if(this.getSingleSelection()){if(!this.getShowRowHeaders()&&this.getRows().length==1){a=U.None}else{a=U.SingleSelectMaster}}else{a=U.MultiSelect}if(t!=a){e.setMode(a)}}function Ne(){return this._oTimeInterval||this._oDateInterval||this._oMonthInterval||this._oWeekInterval||this._oOneMonthInterval}return ee});
/*!
* OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/library","sap/ui/Device","sap/m/HyphenationSupport","./TextRenderer"],function(e,t,i,n,r,a){"use strict";var o=i.TextAlign;var p=i.TextDirection;var s=e.WrappingType;var h=t.extend("sap.m.Text",{metadata:{interfaces:["sap.ui.core.IShrinkable","sap.ui.core.IFormContent","sap.m.IHyphenation"],library:"sap.m",properties:{text:{type:"string",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:p.Inherit},wrapping:{type:"boolean",group:"Appearance",defaultValue:true},wrappingType:{type:"sap.m.WrappingType",group:"Appearance",defaultValue:s.Normal},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:o.Begin},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxLines:{type:"int",group:"Appearance",defaultValue:null},renderWhitespace:{type:"boolean",group:"Appearance",defaultValue:false}},designtime:"sap/m/designtime/Text.designtime"}});h.prototype.normalLineHeight=1.2;h.prototype.cacheLineHeight=true;h.prototype.ellipsis="...";h.hasNativeLineClamp=function(){return typeof document.documentElement.style.webkitLineClamp!="undefined"&&n.browser.chrome}();h.setNodeValue=function(e,t){t=t||"";var i=e.childNodes;if(i.length===1&&i[0].nodeType===window.Node.TEXT_NODE){i[0].nodeValue=t}else{e.textContent=t}};h.prototype.getText=function(e){var t=this.getProperty("text");if(e){return t.replace(/\r\n|\n\r|\r/g,"\n")}return t};h.prototype.onAfterRendering=function(){if(this.getVisible()&&this.hasMaxLines()&&!this.canUseNativeLineClamp()){var e=sap.ui.getCore();if(e.isThemeApplied()){this.clampHeight()}else{e.attachThemeChanged(this._handleThemeLoad,this)}}};h.prototype._handleThemeLoad=function(){this.clampHeight();var e=sap.ui.getCore();e.detachThemeChanged(this._handleThemeLoad,this)};h.prototype.hasMaxLines=function(){return this.getWrapping()&&this.getMaxLines()>1};h.prototype.getTextDomRef=function(){if(!this.getVisible()){return null}if(this.hasMaxLines()){return this.getDomRef("inner")}return this.getDomRef()};h.prototype.canUseNativeLineClamp=function(){if(!h.hasNativeLineClamp){return false}if(this.getTextDirection()==p.RTL){return false}if(this.getTextDirection()==p.Inherit&&sap.ui.getCore().getConfiguration().getRTL()){return false}return true};h.prototype.getLineHeight=function(e){if(this.cacheLineHeight&&this._fLineHeight){return this._fLineHeight}e=e||this.getTextDomRef();if(!e){return 0}var t=window.getComputedStyle(e),i=t.lineHeight,r;if(/px$/i.test(i)){r=parseFloat(i)}else if(/^normal$/i.test(i)){r=parseFloat(t.fontSize)*this.normalLineHeight}else{r=parseFloat(t.fontSize)*parseFloat(i)}if(!n.browser.firefox){r=Math.floor(r)}if(this.cacheLineHeight&&r){this._fLineHeight=r}return r};h.prototype.getClampHeight=function(e){e=e||this.getTextDomRef();return this.getMaxLines()*this.getLineHeight(e)};h.prototype.clampHeight=function(e){e=e||this.getTextDomRef();if(!e){return 0}var t=this.getClampHeight(e);if(t){e.style.maxHeight=t+"px"}return t};h.prototype.clampText=function(e,t,i){e=e||this.getTextDomRef();if(!e){return}var n;var r=this.getText(true);var a=this.getClampHeight(e);t=t||0;i=i||r.length;h.setNodeValue(e,r.slice(0,i));if(e.scrollHeight>a){var o=e.style,p=o.height,s=this.ellipsis,l=s.length;o.height=a+"px";while(i-t>l){n=t+i>>1;h.setNodeValue(e,r.slice(0,n-l)+s);if(e.scrollHeight>a){i=n}else{t=n}}if(e.scrollHeight>a&&t>0){n=t;e.textContent=r.slice(0,n-l)+s}o.height=p}return n};h.prototype.getAccessibilityInfo=function(){return{description:this.getText()}};h.prototype.getTextsToBeHyphenated=function(){return{main:this.getText(true)}};h.prototype.getDomRefsForHyphenatedTexts=function(){return{main:this.getTextDomRef()}};r.mixInto(h.prototype);return h});
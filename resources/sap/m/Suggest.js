/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Bar","./Button","./SuggestionsList","./SuggestionItem","sap/ui/Device","sap/m/library"],function(e,t,n,i,s,r,a){"use strict";var o=a.PlacementType;function u(u){var l=u,f,c,p,d=r.system.phone,g=this;e.sap.require(d?"sap.m.Dialog":"sap.m.Popover");function h(e){var t=e.srcControl;var n;if(t instanceof s){n=t.getSuggestionText();g._suggestionItemTapped=true;f.close();window.setTimeout(function(){u.setValue(n);u.fireSearch({query:n,suggestionItem:t,refreshButtonPressed:false,clearButtonPressed:false})},0)}}function m(){var e,i,s,r,a;s=new(sap.ui.require("sap/m/SearchField"))({liveChange:function(e){var t=e.getParameter("newValue");u.setValue(t);u.fireLiveChange({newValue:t});u.fireSuggest({suggestValue:t});g.update()},search:function(t){if(!t.getParameter("clearButtonPressed")){e.close()}}});r=new t({contentLeft:s});a=new n({text:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("MSGBOX_CANCEL"),press:function(){e._oCloseTrigger=true;e.close()}});e=new(sap.ui.require("sap/m/Dialog"))({stretch:true,customHeader:r,content:P(),beginButton:a,beforeOpen:function(){i=u.getValue();s.setValue(i)},beforeClose:function(e){if(e.getParameter("origin")){u.setValue(i)}else{u.setValue(s.getValue())}},afterClose:function(e){if(!e.getParameter("origin")&&!g._suggestionItemTapped){u.fireSearch({query:u.getValue(),refreshButtonPressed:false,clearButtonPressed:false})}}});e.addEventDelegate({ontap:h},u);return e}function v(){var e=g._oPopover=new(sap.ui.require("sap/m/Popover"))({showArrow:false,showHeader:false,horizontalScrolling:false,placement:o.Vertical,offsetX:0,offsetY:0,initialFocus:l,bounce:false,afterOpen:function(){u.$("I").attr("aria-autocomplete","list").attr("aria-haspopup","true")},beforeClose:function(){u.$("I").attr("aria-haspopup","false").removeAttr("aria-activedecendant")},content:P()}).addStyleClass("sapMSltPicker").addStyleClass("sapMSltPicker-CTX");e.open=function(){return this.openBy(l)};e.addEventDelegate({onAfterRendering:g.setPopoverMinWidth.bind(g),ontap:h},u);return e}function P(){if(!c){c=new i({parentInput:l})}return c}function S(){if(f===undefined){f=d?m():v()}return f}this.setPopoverMinWidth=function(){var e=g._oPopover.getDomRef();if(e){var t=u.$().outerWidth()/parseFloat(a.BaseFontSize)+"rem";e.style.minWidth=t}};this.destroy=function(){if(f){f.close();f.destroy();f=null}if(c){c.destroy();c=null}};this.close=function(){if(!d&&this.isOpen()){f.close()}};this.open=function(){if(!this.isOpen()){this.setSelected(-1);this._suggestionItemTapped=false;S().open()}};this.update=function(){var e=P();window.clearTimeout(p);if(this.isOpen()){p=window.setTimeout(e.update.bind(e),50)}};this.isOpen=function(){return!!f&&f.isOpen()};this.getSelected=function(){return P().getSelectedItemIndex()};this.setSelected=function(e,t){return P().selectByIndex(e,t)}}return u},true);
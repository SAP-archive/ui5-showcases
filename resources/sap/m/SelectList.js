/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/core/Item","./SelectListRenderer","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(e,t,i,s,o,n){"use strict";var r=e.touch;var a=e.SelectListKeyboardNavigationMode;var l=t.extend("sap.m.SelectList",{metadata:{library:"sap.m",properties:{enabled:{type:"boolean",group:"Behavior",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},selectedKey:{type:"string",group:"Data",defaultValue:""},selectedItemId:{type:"string",group:"Misc",defaultValue:""},showSecondaryValues:{type:"boolean",group:"Misc",defaultValue:false},keyboardNavigationMode:{type:"sap.m.SelectListKeyboardNavigationMode",group:"Behavior",defaultValue:a.Delimited}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Item",multiple:true,singularName:"item",bindable:"bindable"}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{selectionChange:{parameters:{selectedItem:{type:"sap.ui.core.Item"}}},itemPress:{parameters:{item:{type:"sap.ui.core.Item"}}}}}});l.prototype._setSelectedIndex=function(e,t){var i;t=t||this.getItems();e=e>t.length-1?t.length-1:Math.max(0,e);i=t[e];if(i){this.setSelection(i)}};l.prototype.updateItems=function(e){this.bItemsUpdated=false;this.destroyItems();this.updateAggregation("items");this.bItemsUpdated=true;this.synchronizeSelection({forceSelection:false});setTimeout(this.synchronizeSelection.bind(this),0)};l.prototype.refreshItems=function(){this.bItemsUpdated=false;this.refreshAggregation("items")};l.prototype._activateItem=function(e){if(e instanceof s&&e&&e.getEnabled()){this.fireItemPress({item:e});if(this.getSelectedItem()!==e){this.setSelection(e);this.fireSelectionChange({selectedItem:e})}}};l.prototype._queryEnabledItemsDomRefs=function(e){var t="."+this.getRenderer().CSS_CLASS+"ItemBase";e=e||this.getDomRef();return e?Array.prototype.slice.call(e.querySelectorAll(t+":not("+t+"Disabled)")):[]};l.prototype._handleARIAActivedescendant=function(){var e=n(document.activeElement).control(0),t=this.getDomRef();if(e&&t){t.setAttribute("aria-activedescendant",e.getId())}};l.prototype.init=function(){this._iStartTimeout=0;this._iActiveTouchId=0;this._fStartX=0;this._fStartY=0;this._oItemNavigation=null;this._$ItemPressed=null};l.prototype.onBeforeRendering=function(){this.synchronizeSelection({forceSelection:false})};l.prototype.onAfterRendering=function(){if(this.getKeyboardNavigationMode()===a.None){this.destroyItemNavigation()}else{this.createItemNavigation()}};l.prototype.exit=function(){this.destroyItemNavigation();this._$ItemPressed=null};l.prototype.ontouchstart=function(e){if(r.countContained(e.touches,this.getId())>1||!this.getEnabled()){return}e.setMarked();var t=e.targetTouches[0];this._iActiveTouchId=t.identifier;this._fStartX=t.pageX;this._fStartY=t.pageY;this._iStartTimeout=setTimeout(function(){var t=e.srcControl.$();if(t){t.addClass(this.getRenderer().CSS_CLASS+"ItemBasePressed");this._$ItemPressed=t}}.bind(this),100)};l.prototype.ontouchmove=function(e){var t=null;if(!this.getEnabled()){return}t=r.find(e.changedTouches,this._iActiveTouchId);if(t&&(Math.abs(t.pageX-this._fStartX)>10||Math.abs(t.pageY-this._fStartY)>10)){clearTimeout(this._iStartTimeout);if(this._$ItemPressed){this._$ItemPressed.removeClass(this.getRenderer().CSS_CLASS+"ItemBasePressed");this._$ItemPressed=null}}};l.prototype.ontouchend=function(e){var t=null;if(!this.getEnabled()){return}e.setMarked();t=r.find(e.changedTouches,this._iActiveTouchId);if(t){setTimeout(function(){if(this._$ItemPressed){this._$ItemPressed.removeClass(this.getRenderer().CSS_CLASS+"ItemBasePressed");this._$ItemPressed=null}this._iStartTimeout=null}.bind(this),100)}};l.prototype.ontouchcancel=l.prototype.ontouchend;l.prototype.ontap=function(e){if(this.getEnabled()){e.setMarked();this._activateItem(e.srcControl)}};l.prototype.onsapselect=function(e){if(this.getEnabled()){e.setMarked();e.preventDefault();this._activateItem(e.srcControl)}};l.prototype.onAfterFocus=function(e){this._handleARIAActivedescendant()};l.prototype.findFirstEnabledItem=function(e){e=e||this.getItems();for(var t=0;t<e.length;t++){if(e[t].getEnabled()){return e[t]}}return null};l.prototype.setSelection=function(e){var t=this.getSelectedItem(),i=this.getRenderer().CSS_CLASS;this.setAssociation("selectedItem",e,true);this.setProperty("selectedItemId",e instanceof s?e.getId():e,true);if(typeof e==="string"){e=sap.ui.getCore().byId(e)}this.setProperty("selectedKey",e?e.getKey():"",true);if(t){t.$().removeClass(i+"ItemBaseSelected").attr("aria-selected","false")}t=this.getSelectedItem();if(t){t.$().addClass(i+"ItemBaseSelected").attr("aria-selected","true")}};l.prototype.synchronizeSelection=function(e){var t=this.getSelectedKey(),i=this.getItemByKey(""+t),s=true;if(e){s=!!e.forceSelection}if(this.isSelectionSynchronized({selectedKey:t,firstItemWithKey:i,forceSelection:s})){return}if(i&&t!==""){this.setAssociation("selectedItem",i,true);this.setProperty("selectedItemId",i.getId(),true)}else if(s&&this.getDefaultSelectedItem()&&(!this.isBound("items")||this.bItemsUpdated)){this.setSelection(this.getDefaultSelectedItem())}};l.prototype.isSelectionSynchronized=function(e){var t=this.getSelectedItem(),i,s,o;if(e){i=e.selectedKey;s=e.firstItemWithKey;o=e.forceSelection}else{i=this.getSelectedKey();s=this.getItemByKey(i);o=this.getForceSelection()}if(o){if(!t){return false}if(i===""&&t.getKey()===""){return true}return i===t.getKey()&&t===s}else{if(t===null&&i===""){return true}if(i===""){return false}return i===(t&&t.getKey())&&t===s}};l.prototype.getForceSelection=function(){return false};l.prototype.findLastEnabledItem=function(e){e=e||this.getItems();return this.findFirstEnabledItem(e.reverse())};l.prototype.getVisibleItems=function(){for(var e=0,t,i=this.getItems(),s=[];e<i.length;e++){t=i[e];if(t.bVisible||t.bVisible===undefined){s.push(t)}}return s};l.prototype.getSelectableItems=function(){return this.getEnabledItems(this.getVisibleItems())};l.prototype.findItem=function(e,t){var i="get"+e.charAt(0).toUpperCase()+e.slice(1);for(var s=0,o=this.getItems();s<o.length;s++){if(o[s][i]()===t){return o[s]}}return null};l.prototype.getItemByText=function(e){return this.findItem("text",e)};l.prototype.isItemSelected=function(e){return e&&e.getId()===this.getAssociation("selectedItem")};l.prototype._getNonSeparatorItemsCount=function(){return this.getItems().filter(function(e){return!(e instanceof sap.ui.core.SeparatorItem)}).length};l.prototype.getDefaultSelectedItem=function(e){return null};l.prototype.clearSelection=function(){this.setSelection(null)};l.prototype.createItemNavigation=function(){var e;if(!this._oItemNavigation){this._oItemNavigation=new i(null,null,!this.getEnabled());this._oItemNavigation.attachEvent(i.Events.AfterFocus,this.onAfterFocus,this);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});this.addEventDelegate(this._oItemNavigation)}e=this.getDomRef();this._oItemNavigation.setRootDomRef(e);this._oItemNavigation.setItemDomRefs(this._queryEnabledItemsDomRefs(e));this._oItemNavigation.setCycling(false);this._oItemNavigation.setSelectedIndex(this.indexOfItem(this.getSelectedItem()));this._oItemNavigation.setPageSize(10)};l.prototype.destroyItemNavigation=function(){if(this._oItemNavigation){this.removeEventDelegate(this._oItemNavigation);this._oItemNavigation.destroy();this._oItemNavigation=null}};l.prototype.getItemNavigation=function(){return this._oItemNavigation};l.prototype.setSelectedItem=function(e){if(typeof e==="string"){this.setAssociation("selectedItem",e,true);e=sap.ui.getCore().byId(e)}if(!(e instanceof s)&&e!==null){return this}if(!e){e=this.getDefaultSelectedItem()}this.setSelection(e);return this};l.prototype.setSelectedItemId=function(e){e=this.validateProperty("selectedItemId",e);this.setSelection(e);return this};l.prototype.setSelectedKey=function(e){e=this.validateProperty("selectedKey",e);var t=this.getItemByKey(e);if(t||e===""){if(!t&&e===""){t=this.getDefaultSelectedItem()}this.setSelection(t);return this}return this.setProperty("selectedKey",e)};l.prototype.getSelectedItem=function(){var e=this.getAssociation("selectedItem");return e===null?null:sap.ui.getCore().byId(e)||null};l.prototype.getItemAt=function(e){return this.getItems()[+e]||null};l.prototype.getFirstItem=function(){return this.getItems()[0]||null};l.prototype.getLastItem=function(){var e=this.getItems();return e[e.length-1]||null};l.prototype.getEnabledItems=function(e){e=e||this.getItems();return e.filter(function(e){return e.getEnabled()})};l.prototype.getItemByKey=function(e){return this.findItem("key",e)};l.prototype.removeItem=function(e){e=this.removeAggregation("items",e);if(this.getItems().length===0){this.clearSelection()}else if(this.isItemSelected(e)){this.setSelection(this.getDefaultSelectedItem())}return e};l.prototype.removeAllItems=function(){var e=this.removeAllAggregation("items",true);this.$().children("li").remove();return e};l.prototype.destroyItems=function(){this.destroyAggregation("items",true);return this};l.prototype.setNoDataText=function(){};return l});
/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/library","sap/ui/core/dnd/DropInfo","sap/f/dnd/GridDragOver","sap/base/Log","sap/ui/Device"],function(r,t,e,n,o){"use strict";var i=t.extend("sap.f.dnd.GridDropInfo",{metadata:{library:"sap.ui.core",interfaces:["sap.ui.core.dnd.IDropInfo"]}});i.prototype.isDroppable=function(r,e){if(!this._shouldEnhance()){return t.prototype.isDroppable.apply(this,arguments)}if(!this.getEnabled()){return false}if(!r||!e){return false}var n=this.getDropTarget();if(!n){return false}var o=n.getDomRefForSetting(this.getTargetAggregation());if(o&&o.contains(e.target)){e.setMark("DragWithin",this.getTargetAggregation());return true}if(!o&&n===r){return true}return false};i.prototype.fireDragEnter=function(r){if(!this._shouldEnhance()){return t.prototype.fireDragEnter.apply(this,arguments)}if(!r||!r.dragSession||!r.dragSession.getDragControl()){return null}this._hideDefaultIndicator(r);var e=this._suggestDropPosition(r);return this.fireEvent("dragEnter",{dragSession:r.dragSession,browserEvent:r.originalEvent,target:e?e.targetControl:null},true)};i.prototype.fireDragOver=function(r){if(!this._shouldEnhance()){return t.prototype.fireDragOver.apply(this,arguments)}if(!r||!r.dragSession||!r.dragSession.getDragControl()){return null}this._hideDefaultIndicator(r);var e=this._suggestDropPosition(r);if(e&&r.dragSession){r.dragSession.setDropControl(e.targetControl)}return this.fireEvent("dragOver",{dragSession:r.dragSession,browserEvent:r.originalEvent,target:e?e.targetControl:null,dropPosition:e?e.position:null})};i.prototype.fireDrop=function(r){if(!this._shouldEnhance()){return t.prototype.fireDrop.apply(this,arguments)}if(!r||!r.dragSession||!r.dragSession.getDragControl()){return null}var n=r.dragSession,o=e.getInstance(),i;o.setCurrentContext(n.getDragControl(),this.getDropTarget(),this.getTargetAggregation());i=o.getSuggestedDropPosition();this.fireEvent("drop",{dragSession:r.dragSession,browserEvent:r.originalEvent,dropPosition:i?i.position:null,draggedControl:n.getDragControl(),droppedControl:i?i.targetControl:null});o.endDrag()};i.prototype._shouldEnhance=function(){if(this._bShouldEnhance===undefined){if(!this.getParent().isA("sap.f.dnd.IGridDroppable")){n.error("The control which uses 'sap.f.dnd.GridDropInfo' has to implement 'sap.f.dnd.IGridDroppable'.","sap.f.dnd.GridDropInfo");this._bShouldEnhance=false;return this._bShouldEnhance}if(o.browser.msie){this._bShouldEnhance=false;return this._bShouldEnhance}this._bShouldEnhance=this.getDropPosition()===r.dnd.DropPosition.Between&&this.getDropLayout()===r.dnd.DropLayout.Horizontal}return this._bShouldEnhance};i.prototype._suggestDropPosition=function(r){if(!r.dragSession||!r.dragSession.getDragControl()){return null}var t=e.getInstance();t.setCurrentContext(r.dragSession.getDragControl(),this.getDropTarget(),this.getTargetAggregation());t.handleDragOver(r);return t.getSuggestedDropPosition()};i.prototype._hideDefaultIndicator=function(r){r.dragSession.setIndicatorConfig({visibility:"hidden",position:"relative"})};return i},true);
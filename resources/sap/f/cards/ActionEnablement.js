/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/Log","sap/f/cards/BindingResolver"],function(e,t,i){"use strict";var a={};function n(e){if(e&&typeof e==="object"){return e.name}return e}function r(e,t){if(!e.actions){this._fireActionReady(t);return}var i=e.actions[0];if(i&&i.type==="Navigation"){this._attachNavigationAction(e,t||this)}else{this._fireActionReady(t)}}function s(t){var a=this;var r=e.bindingParser("{path:''}");r.formatter=function(e){var r=this.getBindingContext(),s=this.getModel(),o;if(r){o=r.getPath()}var c=i.resolveValue(t.parameters,s,o);if(e.__resolved){if(e.__enabled){return"Navigation"}else{return"Inactive"}}if(!e.__promise){e.__promise=true;a._oServiceManager.getService(n(t.service)).then(function(t){if(t){t.enabled({parameters:c}).then(function(t){e.__resolved=true;e.__enabled=t;a.getModel().checkUpdate(true)}).catch(function(){e.__resolved=true;e.__enabled=false})}else{e.__resolved=true;e.__enabled=false}})}return"Inactive"};this._oItemTemplate.bindProperty("type",r)}function o(e){var t=e.actions[0],a=this.getBindingContext(),r=t.parameters,s=this.getModel(),o;if(a){o=a.getPath()}r=i.resolveValue(t.parameters,s,o);return new Promise(function(e){this._oServiceManager.getService(n(t.service)).then(function(t){if(t){t.enabled({parameters:r}).then(function(t){e(t)}).catch(function(){e(false)})}else{e(false)}}).catch(function(){e(false)})}.bind(this))}function c(t){var i;if(typeof t.enabled==="string"){i=e.bindingParser(t.enabled);i.formatter=function(e){if(e&&typeof e==="string"){return"Navigation"}else{return"Inactive"}}}if(i){this._oItemTemplate.bindProperty("type",i)}else{var a=t.enabled!==false?true:false;var n=a?"Navigation":"Inactive";this._oItemTemplate.setProperty("type",n)}}function f(){this.addStyleClass("sapFCardClickable")}a._fireAction=function(e,t,a,n){this.fireEvent("action",{type:"Navigation",actionSource:e,manifestParameters:i.resolveValue(t,a,n)})};a.openUrl=function(e,t){window.open(e,t.target||"_blank")};a._attachNavigationAction=function(e,r){var s=e.actions[0];var o;var c=true;var f=function(){r.attachPress(o.bind(this));if(this._addHeaderClasses){this._addHeaderClasses()}}.bind(this);if(s.service){if(this._setItemTypeFormatter){this._setItemTypeFormatter(s)}o=function(e){var r=e.getSource(),o=r.getBindingContext(),c=r.getModel(),f;if(o){f=o.getPath()}this._oServiceManager.getService(n(s.service)).then(function(e){if(e){e.navigate({parameters:i.resolveValue(s.parameters,c,f)})}}).catch(function(e){t.error("Navigation service unavailable",e)}).finally(function(){a._fireAction.call(this,e.getSource(),s.parameters,c,f)}.bind(this))}.bind(this);c=false}else{if(this._setActionEnabledState){this._setActionEnabledState(s);c=false}if(s.url){o=function(e){var t=e.getSource(),n=t.getBindingContext(),r=t.getModel(),o,c;if(n){o=n.getPath()}c=i.resolveValue(s.url,r,o);a.openUrl(c,s);a._fireAction.call(this,e.getSource(),s.parameters,r,o)}.bind(this)}else{o=function(e){var t=e.getSource(),i=t.getBindingContext(),n=t.getModel(),r;if(i){r=i.getPath()}a._fireAction.call(this,e.getSource(),s.parameters,n,r)}.bind(this)}}if((r.isA("sap.f.cards.IHeader")||r.isA("sap.f.cards.AnalyticalContent")||r.isA("sap.f.cards.ObjectContent"))&&s.service){this._setHeaderActionEnabledState(e).then(function(e){if(e){f()}this._fireActionReady(r)}.bind(this));return}else{if(c){if(s.enabled!==false){f()}}else{f()}this._fireActionReady(r)}};function l(e){if(e&&e.isA("sap.f.cards.IHeader")){this.fireEvent("_actionHeaderReady")}else{this.fireEvent("_actionContentReady")}}a.enrich=function(e){e.prototype._attachActions=r;e.prototype._attachNavigationAction=this._attachNavigationAction;e.prototype._fireActionReady=l;if(e.prototype.isA("sap.f.cards.ListContent")||e.prototype.isA("sap.f.cards.TableContent")){e.prototype._setItemTypeFormatter=s;e.prototype._setActionEnabledState=c}if(e.prototype.isA("sap.f.cards.IHeader")||e.prototype.isA("sap.f.cards.AnalyticalContent")||e.prototype.isA("sap.f.cards.ObjectContent")){e.prototype._addHeaderClasses=f;e.prototype._setHeaderActionEnabledState=o}};return a});
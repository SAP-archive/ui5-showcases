/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/f/cards/ActionEnablement","sap/m/NumericContent","sap/m/Text","sap/ui/model/json/JSONModel","sap/f/cards/NumericSideIndicator","sap/f/cards/NumericHeaderRenderer","sap/base/strings/formatMessage"],function(t,e,i,a,r,s,n,o){"use strict";var u=t.extend("sap.f.cards.NumericHeader",{metadata:{interfaces:["sap.f.cards.IHeader"],properties:{title:{type:"string",group:"Appearance"},subtitle:{type:"string",group:"Appearance"},statusText:{type:"string",defaultValue:""},unitOfMeasurement:{type:"string",group:"Data"},number:{type:"string",group:"Data"},scale:{type:"string",group:"Data"},trend:{type:"sap.m.DeviationIndicator",group:"Appearance",defaultValue:"None"},state:{type:"sap.m.ValueColor",group:"Appearance",defaultValue:"Neutral"},details:{type:"string",group:"Appearance"}},aggregations:{sideIndicators:{type:"sap.f.cards.NumericSideIndicator",multiple:true},_title:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_subtitle:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_unitOfMeasurement:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_details:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_mainIndicator:{type:"sap.m.NumericContent",multiple:false,visibility:"hidden"}},events:{press:{}}}});u.prototype.init=function(){this._aReadyPromises=[];this._bReady=false;this._awaitEvent("_dataReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready")}.bind(this));this.setBusyIndicatorDelay(0)};u.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null}};u.prototype._awaitEvent=function(t){this._aReadyPromises.push(new Promise(function(e){this.attachEventOnce(t,function(){e()})}.bind(this)))};u.prototype.isReady=function(){return this._bReady};u.prototype.setTitle=function(t){this.setProperty("title",t,true);this._getTitle().setText(t);return this};u.prototype.setSubtitle=function(t){this.setProperty("subtitle",t,true);this._getSubtitle().setText(t);return this};u.prototype.setUnitOfMeasurement=function(t){this.setProperty("unitOfMeasurement",t,true);this._getUnitOfMeasurement().setText(t);return this};u.prototype.setDetails=function(t){this.setProperty("details",t,true);this._getDetails().setText(t);return this};u.prototype.setNumber=function(t){this.setProperty("number",t,true);this._getMainIndicator().setValue(t);return this};u.prototype.setScale=function(t){this.setProperty("scale",t,true);this._getMainIndicator().setScale(t);return this};u.prototype.setTrend=function(t){this.setProperty("trend",t,true);this._getMainIndicator().setIndicator(t);return this};u.prototype.setState=function(t){this.setProperty("state",t,true);this._getMainIndicator().setValueColor(t);return this};u.prototype._getTitle=function(){var t=this.getAggregation("_title");if(!t){t=new a({id:this.getId()+"-title",wrapping:true,maxLines:3});this.setAggregation("_title",t)}return t};u.prototype._getSubtitle=function(){var t=this.getAggregation("_subtitle");if(!t){t=new a({id:this.getId()+"-subtitle",wrapping:true,maxLines:2});this.setAggregation("_subtitle",t)}return t};u.prototype._getUnitOfMeasurement=function(){var t=this.getAggregation("_unitOfMeasurement");if(!t){t=new a({id:this.getId()+"-unitOfMeasurement",wrapping:false});this.setAggregation("_unitOfMeasurement",t)}return t};u.prototype._getDetails=function(){var t=this.getAggregation("_details");if(!t){t=new a({id:this.getId()+"-details",wrapping:false});this.setAggregation("_details",t)}return t};u.prototype._getMainIndicator=function(){var t=this.getAggregation("_mainIndicator");if(!t){t=new i({id:this.getId()+"-mainIndicator",withMargin:false,nullifyValue:false,animateTextChange:false,truncateValueTo:5});this.setAggregation("_mainIndicator",t)}return t};u.prototype.ontap=function(){this.firePress()};u.create=function(t,e,i){var a={title:t.title,subtitle:t.subTitle,unitOfMeasurement:t.unitOfMeasurement,details:t.details};if(t.mainIndicator){a.number=t.mainIndicator.number;a.scale=t.mainIndicator.unit;a.trend=t.mainIndicator.trend;a.state=t.mainIndicator.state}if(t.sideIndicators){a.sideIndicators=t.sideIndicators.map(function(t){return new s(t)})}if(t.status&&typeof t.status.text==="string"){a.statusText=t.status.text}var r=new u(a);if(t.status&&t.status.text&&t.status.text.format){u._bindStatusText(t.status.text.format,r)}r.setServiceManager(e);r.setDataProviderFactory(i);r._setData(t.data);r._attachActions(t,r);return r};u._bindStatusText=function(t,e){if(t.parts&&t.translationKey&&t.parts.length===2){var i={parts:[t.translationKey,t.parts[0].toString(),t.parts[1].toString()],formatter:function(e,i,a){var r=i||t.parts[0];var s=a||t.parts[1];if(Array.isArray(i)){r=i.length}if(Array.isArray(a)){s=a.length}var n=parseFloat(r)||0;var u=parseFloat(s)||0;return o(e,[n,u])}};e.bindProperty("statusText",i)}};u.prototype.setServiceManager=function(t){this._oServiceManager=t;return this};u.prototype.setDataProviderFactory=function(t){this._oDataProviderFactory=t;return this};u.prototype._setData=function(t){var e="/";if(t&&t.path){e=t.path}this.bindObject(e);if(this._oDataProvider){this._oDataProvider.destroy()}this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager);if(this._oDataProvider){this.setBusy(true);this.setModel(new r);this._oDataProvider.attachDataChanged(function(t){this._updateModel(t.getParameter("data"));this.setBusy(false)}.bind(this));this._oDataProvider.attachError(function(t){this._handleError(t.getParameter("message"));this.setBusy(false)}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady")}.bind(this))}else{this.fireEvent("_dataReady")}};u.prototype._updateModel=function(t){this.getModel().setData(t)};u.prototype._handleError=function(t){this.fireEvent("_error",{logMessage:t})};u.prototype._getHeaderAccessibility=function(){var t=this._getTitle()?this._getTitle().getId():"",e=this._getSubtitle()?this._getSubtitle().getId():"",i=this._getUnitOfMeasurement()?this._getUnitOfMeasurement().getId():"",a=this.getSideIndicators()?this._getSideIndicatorIds():"",r=this._getDetails()?this._getDetails().getId():"",s=this._getMainIndicator()?this._getMainIndicator().getId():"";return t+" "+e+" "+i+" "+s+a+" "+r};u.prototype._getSideIndicatorIds=function(){var t="";this.getSideIndicators().forEach(function(e){t+=" "+e.getId()});return t};e.enrich(u);return u});
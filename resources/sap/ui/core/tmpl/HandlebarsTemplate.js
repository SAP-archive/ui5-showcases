/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","./Template","./TemplateControl","sap/ui/thirdparty/handlebars","sap/ui/base/ManagedObject","sap/base/util/ObjectPath","sap/base/security/encodeXML","sap/ui/thirdparty/jquery"],function(e,t,a,r,n,o,i,s){"use strict";var h=t.extend("sap.ui.core.tmpl.HandlebarsTemplate",{constructor:function(e,a){t.apply(this,arguments)}});t.registerType("text/x-handlebars-template","sap.ui.core.tmpl.HandlebarsTemplate");function l(e){for(var t in e){e[t]=e[t].replace("&gt;",">").replace("&lt;","<").replace("&quot;",'"').replace("&amp;","&")}}function p(e,t){var a=/^((\w+)>)?(.*)/,r=a.exec(e),n=r[2],o=a.exec(t),i=o[2];var r=a.exec(e);if(t&&n==i){return t+r[3]}else{return e}}h.RENDER_HELPERS=function(){var e=r.helpers["each"],t=r.helpers["with"],a=r.helpers["if"],h=r.helpers["unless"],g=sap.ui.getCore().createRenderManager();g.renderControl=function(e){this.writeControlData(e);this.writeClasses(e);this.writeStyles(e)};var f={each:function(t,a){a=a||t;if(!a.hash.path){return e.apply(this,arguments)}else{l(a.hash);var n=a.data.renderManager,o=a.data.rootControl,i=a.data.path,s=a.data.parentControl,h=p(a.hash.path,i),g=o.bindList(h),f=[],d;if(a.data){d=r.createFrame(a.data)}if(g){for(var u in g){if(d){d.renderManager=n;d.rootControl=o;d.path=h+"/"+u+"/";d.parentControl=s}f.push(a.fn({},{data:d}))}}if(!s){return new r.SafeString(f.join(""))}}},with:function(e,a){a=a||e;if(!a.hash.path){return t.apply(this,arguments)}},if:function(e,t){t=t||e;if(!t.hash.path){return a.apply(this,arguments)}else{l(t.hash);var r=t.data.rootControl,n=t.data.path,o=p(t.hash.path,n);if(o){var i=r.bindProp(o);if(i){return t.fn(this)}else{return t.inverse(this)}}}},unless:function(e,t){t=t||e;if(!t.hash.path){return h.apply(this,arguments)}else{l(t.hash);var a=t.data.rootControl,r=t.data.path,n=p(t.hash.path,r);if(n){var o=a.bindProp(n);if(!o){return t.fn(this)}else{return t.inverse(this)}}}},text:function(e,t){t=t||e;l(t.hash);var a=t.data.rootControl,n=t.data.path,o=p(t.hash.path,n);if(o){var s=a.bindProp(o);return s&&new r.SafeString(i(s))}else{throw new Error('The expression "text" requires the option "path"!')}},element:function(e,t){t=t||e;l(t.hash);var a=t.data.renderManager,n=t.data.rootControl,o=n.createDOMElement(t.hash,t.data.path),i=t.data.parentElement;if(t.fn){t.fn({},{data:{renderManager:a,rootControl:n,parentElement:o}})}if(i){i.addElement(o);return}return new r.SafeString(a.getHTML(o))},control:function(e,t){t=t||e;l(t.hash);var a=t.data.renderManager,i=t.data.control;if(i){return new r.SafeString(a.getHTML(i))}var h=t.data.rootControl,p=t.data.path,g=t.data.children,f=t.hash["sap-ui-type"],d=o.get(f||""),u=d&&d.getMetadata(),c=t.hash["sap-ui-default-aggregation"]||u&&u.getDefaultAggregationName(),v=t.data.view;if(!d){throw new Error("Control of type "+f+" cannot be found.")}var m={};if(t.fn){t.fn({},{data:{rootControl:h,path:p,children:m,defaultAggregation:c,view:v}})}var C=s.extend({},t.hash),w;for(var y in C){if(y==="sap-ui-class"&&typeof C[y]==="string"){w=C["sap-ui-class"]&&C["sap-ui-class"].split(" ");delete C[y]}else if(m[y]){delete C[y]}}var M=h.createControl(C,t.data.path,!!g,v);if(w&&w.length>0){w.forEach(M.addStyleClass.bind(M))}if(!s.isEmptyObject(m)){C=t.hash;var E=u.getAllAggregations();for(var S in m){var b=m[S];for(var T=0,x=b.length;T<x;T++){var A=b[T],H=E[S],L=H&&H.multiple;if(typeof C[S]==="string"){var P=n.bindingParser(C[S],v&&v.getController());P.template=A;M.bindAggregation(S,P)}else{if(L){M.addAggregation(S,A)}else{M.setAggregation(S,A)}}}}}if(g){var S=t.hash["sap-ui-aggregation"]||t.data.defaultAggregation;g[S]=g[S]||[];g[S].push(M);return}return new r.SafeString(a.getHTML(M))},property:function(e,t){t=t||e;l(t.hash);var a=t.data.rootControl,r=a.getMetadata(),n=t.hash.name,o=r.getProperty(n)._sGetter;return a[o]()},aggregation:function(e,t){t=t||e;l(t.hash);if(t.data.children){var a=t.hash.name;if(t.fn){var n=s.extend({},t.data,{defaultAggregation:a});t.fn({},{data:n})}}else{var o=t.data.renderManager,i=t.data.rootControl,h=i.getMetadata(),a=t.hash.name,p=h.getAggregation(a)._sGetter,g=[];var f=i[p]();if(f){for(var d=0,u=f.length;d<u;d++){if(t.fn){g.push(t.fn({},{data:{renderManager:o,rootControl:i,control:f[d]}}))}else{g.push(o.getHTML(f[d]))}}}return new r.SafeString(g.join(""))}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;var a=t.data.rootControl;return new r.SafeString(g.getHTML(a))}};return f}();h.prototype.createMetadata=function(){var e=this.getContent(),t=this._fnTemplate=this._fnTemplate||r.compile(e);var n={},o=a.getMetadata().getAllSettings(),i=a.getMetadata().getAllPrivateAggregations();var h={property:function(e,t){t=t||e;l(t.hash);var a=t.hash.name;if(a&&a!=="id"&&!o[a]){n.properties=n.properties||{};n.properties[a]=s.extend({},{type:"string"},t.hash)}else{throw new Error('The property name "'+a+'" is reserved.')}},aggregation:function(e,t){t=t||e;l(t.hash);var a=t.hash.name;if(a&&!o[a]&&!i[a]){t.hash.multiple=t.hash.multiple=="true";n.aggregations=n.aggregations||{};n.aggregations[a]=s.extend({},t.hash)}else{throw new Error('The aggregation name "'+a+'" is reserved.')}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;n._hasControlData=true}};["each","if","unless","with"].forEach(function(e){h[e]=function(){}});t({},{helpers:h});return n};h.prototype.createRenderer=function(e){var t=this.getContent(),a=this._fnTemplate=this._fnTemplate||r.compile(t);var n=function(t,r){var n=a(r.getContext()||{},{data:{renderManager:t,rootControl:r,view:e},helpers:h.RENDER_HELPERS});t.write(n)};return n};return h});
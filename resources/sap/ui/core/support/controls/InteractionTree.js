/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/IconPool","sap/m/library","sap/m/Popover","sap/m/Text","sap/ui/layout/form/SimpleForm","sap/m/Button","sap/m/Label","sap/m/Link","sap/ui/core/HTML","sap/ui/core/Title"],function(t,e,a,r,i,n,s,o,p,l,u){"use strict";var d=a.PlacementType;var c=t.extend("sap.ui.core.support.controls.InteractionTree",{constructor:function(){this.start=0;this.end=1}});c.expandIcon="sap-icon://navigation-right-arrow";c.collapseIcon="sap-icon://navigation-down-arrow";c.headerIcon='<img class="sapUiInteractionSvgImage" src="HeaderIcon.svg">';c.prototype.setInteractions=function(t){this.interactions=t;this.start=0;this.end=1;this.updateRanges()};c.prototype.setRange=function(t,e){this.start=t;this.end=e;this.updateRanges();this.update()};c.prototype.updateRanges=function(){var t=this.interactions;if(!t||!t.length){return}this.startTime=t[0].start;this.endTime=t[t.length-1].end;var e=this.endTime-this.startTime;this.actualStartTime=this.startTime+this.start*e;this.actualEndTime=this.startTime+this.end*e;this.timeRange=this.actualEndTime-this.actualStartTime};c.prototype.update=function(){if(!this.parent){return}jQuery(this.parent).find("#"+this.getId()).remove();this.renderAt(this.parent)};c.prototype.renderAt=function(t){this.parent=t;var e=sap.ui.getCore().createRenderManager();this.render(e);e.flush(t);e.destroy();this.attachEvents();this.attachInteractionDetailsPopover();this.attachRequestDetailsPopover()};c.prototype.render=function(t){t.write('<div id="'+this.getId()+'" class="sapUiInteractionTreeContainer sapUiSizeCompact">');t.write('<div class="sapUiInteractionGridLinesContainer"></div>');t.write("<ul");t.addClass("sapUiInteractionTree");t.writeClasses();t.write(">");this.renderHeaders(t);var e,a=this.interactions;if(!a||!a.length){return}for(var r=0;r<a.length;r++){e=a[r];this.renderInteraction(t,e,r)}t.write("</ul>");t.write("</div>")};c.prototype.attachEvents=function(){var t=this,e=jQuery(".sapUiInteractionTreeContainer .sapUiInteractionTree");this.gridContainer=jQuery(".sapUiInteractionTreeContainer .sapUiInteractionGridLinesContainer");this.gridContainerWidth=0;e.bind("click",function(e){var a=jQuery(e.target);if(a.hasClass("sapUiInteractionLeft")){t.handleInteractionClick(a)}});this.gridContainer.resize(function(e){t.updateGridLines()});jQuery(window).resize(function(e){t.updateGridLines()});t.updateGridLines()};c.prototype.updateGridLines=function(){var t=this.gridContainer,e=this.timeRange,a=this.gridContainer.width();if(this.gridContainerWidth==a){return}t.empty();t.append('<div style="left:'+(this.getPosition(a,e,0)+6)+'px" class="sapUiInteractionGridLineIntervalText">'+this.formatGridLineDuration(0)+"</div>");var r=this.calculateInterval(a,e);for(var i=r;i<e;i+=r){var n=this.getPosition(a,e,i);if(i+r<e){t.append('<div style="left:'+(n+6)+'px" class="sapUiInteractionGridLineIntervalText">'+this.formatGridLineDuration(i)+"</div>")}t.append('<div style="left:'+n+'px" class="sapUiInteractionGridLine"></div>')}this.gridContainerWidth=a};c.prototype.calculateInterval=function(t,e){var a=4;var r=Math.max(t*a/200,1);var i=e/r;var n=Math.pow(10,Math.floor(Math.log(i)/Math.LN10));var s=[10,5,2,1];for(var o=0;o<s.length;o++){var p=s[o];var l=n*p;if(r<e/l){break}i=l}return i};c.prototype.getPosition=function(t,e,a){var r=t/e*a;return r};c.prototype.handleInteractionClick=function(t){var e=t.find(".sapUiInteractionTreeIcon");if(!e.length){return}var a=e.attr("expanded")=="true";var r=e.parent();e.remove();var i=this.getIconHTML(!a);r.children().eq(0).after(i);var n=r.parent().parent();n.toggleClass("sapUiInteractionItemExpanded");var s=parseInt(n.attr("data-interaction-index"));this.interactions[s].isExpanded=!a;var o=n.find("ul");var p=a?"slideUp":"slideDown";o.stop(true,true)[p]("fast",function(){o.toggleClass("sapUiHiddenUiInteractionItems")})};c.prototype.renderHeaders=function(t){t.write("<li>");t.write("<div");t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionItemDiv");t.addClass("sapUiInteractionHeader");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionTreeItemLeft">');t.write("<div>");t.write('<span class="sapUiInteractionItemComponentText">');t.writeEscaped("Component");t.write("</span>");t.write("<br/>");t.write('<span class="sapUiInteractionItemTriggerText">');t.writeEscaped("Trigger");t.write("</span>");t.write("</div>");t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight">');t.write("</div>");t.write("</div>");t.write("</li>")};c.prototype.isInteractionVisible=function(t){var e=t.start;var a=t.end;if(this.actualStartTime>a||this.actualEndTime<e){return false}if(this.actualStartTime<e+t.duration&&this.actualEndTime>e){return true}return this.hasVisibleRequests(t)};c.prototype.hasVisibleRequests=function(t){var e,a,r,i=t.requests;for(var n=0;n<i.length;n++){e=i[n];a=e.fetchStartOffset+e.startTime;r=e.fetchStartOffset+e.startTime+this.getRequestDuration(e);if(this.actualStartTime<r&&this.actualEndTime>a){return true}}return false};c.prototype.renderInteraction=function(t,e,a){var r,i=e.requests;if(!this.isInteractionVisible(e)){return}t.write('<li data-interaction-index="'+a+'"');if(e.isExpanded){t.addClass("sapUiInteractionItemExpanded");t.writeClasses()}t.write(">");this.renderInteractionDiv(t,e);t.write("<ul");t.addClass("sapUiInteractionItem");if(!e.isExpanded){t.addClass("sapUiHiddenUiInteractionItems")}t.writeClasses();t.write(">");for(var n=0;n<i.length;n++){r=i[n];this.renderRequest(t,e,r,n)}t.write("</ul>");t.write("</li>")};c.prototype.renderInteractionDiv=function(t,e){t.write("<div");t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionItemDiv");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionLeft sapUiInteractionTreeItemLeft">');t.write("<div>");t.write('<span class="sapUiInteractionItemComponentText">');t.writeEscaped(e.component!=="undetermined"?e.component:"Initial Loading");t.write("</span>");t.write("<br/>");t.write('<span class="sapUiInteractionItemTriggerText">');t.writeEscaped(e.trigger+" / "+e.event);t.write("</span>");t.write("</div>");if(e.requests.length){this.renderIcon(t,e.isExpanded)}if(e.sapStatistics.length&&e.requests.length){t.write('<div class="sapUiInteractionHeaderIcon">'+c.headerIcon+"</div>")}t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight">');var a=Math.round(e.start+e.duration);this.renderInteractionPart(t,e.start,a,"sapUiInteractionBlue");t.write("</div>");t.write("</div>")};c.prototype.renderInteractionPart=function(t,e,a,r){if(this.actualStartTime>a||this.actualEndTime<e){return}a=Math.min(a,this.actualEndTime);e=Math.max(e,this.actualStartTime);var i=100/this.timeRange*(e-this.actualStartTime);var n=100/this.timeRange*(a-this.actualStartTime);var s=n-i;t.write('<span style="margin-left: '+i+"%; width: "+s+'%" class="sapUiInteractionTimeframe sapUiInteractionTimeInteractionFrame '+r+'"></span>')};c.prototype.renderRequest=function(t,e,a,r){var i=a.fetchStartOffset;var n=i+a.startTime;var s=i+a.startTime+this.getRequestDuration(a);if(this.actualStartTime>s||this.actualEndTime<n){return}t.write('<li data-request-index="'+r+'"');t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionRequest");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionTreeItemLeft sapUiInteractionRequestLeft">');var o=a.initiatorType||a.entryType;var p=this.getRequestColorClass(o);t.write('<span class="sapUiInteractionRequestIcon '+p+'"></span>');t.write('<span class="sapUiInteractionItemEntryTypeText">');t.writeEscaped(o);t.write("</span>");if(this.getRequestSapStatistics(e,a)){t.write('<div class="sapUiInteractionRequestHeaderIcon">'+c.headerIcon+"</div>")}t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight"');t.write(">");var l=this.getRequestRequestStart(a)+i;var u=this.getRequestResponseStart(a)+i;this.renderRequestPart(t,n,l,p+"70");this.renderRequestPart(t,l,u,p);this.renderRequestPart(t,u,s,p+"70");t.write("</div>");t.write("</li>")};c.prototype.getRequestSapStatistics=function(t,e){var a,r=t.sapStatistics;for(var i=0;i<r.length;i++){if(r[i].timing&&e.startTime===r[i].timing.startTime){a=r[i];return a}}return false};c.prototype.getRequestColorClass=function(t){var e;switch(t){case"xmlhttprequest":e="sapUiPurple";break;case"OData":e="sapUiRed";break;case"link":case"css":e="sapUiAccent1";break;default:e="sapUiAccent8";break}return e};c.prototype.attachRequestDetailsPopover=function(){var t,a,c,h,v,I,f,m,T,S,w,g,y,C,U,x,R;var q=this;var b=jQuery(".sapUiInteractionRequest.sapUiInteractionTreeItem .sapUiInteractionTreeItemRight");if(b.length){var L=A();for(var D=0;D<b.length;D++){b[D].addEventListener("click",function(t){M.call(this);P.call(this);E.call(this);var e=jQuery(this).children()[0];L.openBy(e)})}}function E(){var e=jQuery(this);var a=e.parents("li[data-request-index]");var r=e.parents("li[data-interaction-index]");var i=parseInt(r.attr("data-interaction-index"));var n=parseInt(a.attr("data-request-index"));var s=q.interactions[i];var o=s.requests[n];if(!s||!o){return}var p=q.getRequestSapStatistics(s,o);if(p){if(!w.getParent()){t.addContent(w);t.addContent(g);t.addContent(y);t.addContent(C);t.addContent(U);t.addContent(x);t.addContent(R)}var l=p.statistics;y.setText(q.formatDuration(parseFloat(l.substring(l.indexOf("total=")+"total=".length,l.indexOf(",")))));l=l.substring(l.indexOf(",")+1);U.setText(q.formatDuration(parseFloat(l.substring(l.indexOf("fw=")+"fw=".length,l.indexOf(",")))));l=l.substring(l.indexOf(",")+1);R.setText(q.formatDuration(parseFloat(l.substring(l.indexOf("app=")+"app=".length,l.indexOf(",")))))}else if(w.getParent()){t.removeContent(w);t.removeContent(g);t.removeContent(y);t.removeContent(C);t.removeContent(U);t.removeContent(x);t.removeContent(R)}}function P(){var t=q.getRequestFromElement(jQuery(this));v.setText(t.initiatorType||"");I.setText(t.entryType||"");f.setText(t.name);f.setHref(t.name);var e=q.getRequestDuration(t);var a=t.fetchStartOffset+t.startTime;var r=a+e;m.setText(q.formatTime(a));T.setText(q.formatTime(r));S.setText(q.formatDuration(e))}function M(){var t=q.getRequestFromElement(jQuery(this));var e=t.fetchStartOffset;var r=q.getRequestDuration(t);var i=e+t.startTime;var n=i+r;var s=q.getRequestRequestStart(t)+e;var o=q.getRequestResponseStart(t)+e;var p=s-i;var l=o-s;var u=n-o;var d=Math.floor(100*l/r);var h=Math.floor(100*u/r);var v=Math.floor(100*p/r);var I='<span class="sapUiInteractionTitleSection"><div class="sapUiInteractionTitleText">{Title}</div><div class="sapUiInteractionTitleSubText">{Subtitle}</div></span>';var f='<div class="sapUiInteractionTitle">';f+=I.replace("{Title}","PREPROCESSING").replace("{Subtitle}",q.formatDuration(p));f+=I.replace("{Title}","SERVER").replace("{Subtitle}",q.formatDuration(l));f+=I.replace("{Title}","CLIENT").replace("{Subtitle}",q.formatDuration(u));f+="</div>";a.setContent(f);var m=t.initiatorType||t.entryType;var T=q.getRequestColorClass(m);var S=T+"70";var w="<span class='sapUiSupportIntProgressBar "+S+"'' style=\"width:calc("+v+"% - 1px)\"></span><span class='sapUiSupportIntProgressBarSeparator'></span>";var g="<span class='sapUiSupportIntProgressBar "+T+"' style=\"width:calc("+d+'% - 1px)"></span>'+"<span class='sapUiSupportIntProgressBarSeparator'></span>";var y="<span class='sapUiSupportIntProgressBar "+S+"'' style=\"width:calc("+h+'% - 1px)"></span>';var C="<div class='sapUiSupportIntProgressBarParent'>"+w+g+y+"</div>";c.setContent(C)}function A(){var t=new r({placement:d.Auto,contentWidth:"400px",showHeader:false,showArrow:true,verticalScrolling:true,horizontalScrolling:false,content:[O()]}).addStyleClass("sapUiSupportPopover");t.attachAfterOpen(function(t){t.getSource().$().focus()});return t}function O(){a=new l;c=new l;h=new s({icon:e.getIconURI("decline"),type:"Transparent",press:function(){L.close()}}).addStyleClass("sapUiSupportReqPopoverCloseButton");h.setTooltip("Close");v=(new i).addStyleClass("sapUiSupportIntRequestText");I=(new i).addStyleClass("sapUiSupportIntRequestText");f=new p({target:"_blank",wrapping:true}).addStyleClass("sapUiSupportIntRequestLink");m=(new i).addStyleClass("sapUiSupportIntRequestText");T=(new i).addStyleClass("sapUiSupportIntRequestText");S=(new i).addStyleClass("sapUiSupportIntRequestText");w=new u({text:"SAP STATISTICS FOR ODATA CALLS"});g=new o({text:"Gateway Total"}).addStyleClass("sapUiSupportIntRequestLabel");y=(new i).addStyleClass("sapUiSupportIntRequestText");C=new o({text:"Framework"}).addStyleClass("sapUiSupportIntRequestLabel");U=(new i).addStyleClass("sapUiSupportIntRequestText");x=new o({text:"Application"}).addStyleClass("sapUiSupportIntRequestLabel");R=(new i).addStyleClass("sapUiSupportIntRequestText");t=new n({maxContainerCols:2,minWidth:400,labelMinWidth:100,editable:false,layout:"ResponsiveGridLayout",labelSpanM:3,emptySpanM:0,columnsM:1,breakpointM:0,content:[new u({text:"REQUEST DATA"}),new o({text:"Initiator Type"}).addStyleClass("sapUiSupportIntRequestLabel"),v,new o({text:"Entry Type"}).addStyleClass("sapUiSupportIntRequestLabel"),I,new o({text:"Name"}).addStyleClass("sapUiSupportIntRequestLabel"),f,new o({text:"Start Time"}).addStyleClass("sapUiSupportIntRequestLabel"),m,new o({text:"End Time"}).addStyleClass("sapUiSupportIntRequestLabel"),T,new o({text:"Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),S]});return[a,c,h,t]}};c.prototype.getRequestFromElement=function(t){var e=t.parents("li[data-request-index]");var a=t.parents("li[data-interaction-index]");var r=parseInt(a.attr("data-interaction-index"));var i=parseInt(e.attr("data-request-index"));var n=this.interactions[r].requests[i];return n};c.prototype.attachInteractionDetailsPopover=function(){var t,a,p,l,c,h,v,I,f;var m=this;var T=jQuery(".sapUiInteractionItemDiv.sapUiInteractionTreeItem .sapUiInteractionTreeItemRight");if(T.length){var S=y();for(var w=0;w<T.length;w++){T[w].addEventListener("click",function(t){g.call(this);var e=jQuery(this).children()[0];S.openBy(e)})}}function g(){var t=jQuery(this).parent().parent();var e=parseInt(t.attr("data-interaction-index"));var a=m.interactions[e];if(!a){return}p.setText(m.formatDuration(a.duration));l.setText(m.formatDuration(a.duration-a.roundtrip));c.setText(m.formatDuration(a.requestTime));h.setText(m.formatDuration(a.roundtrip));v.setText(a.bytesReceived);I.setText(a.requests.length);f.setText(m.formatTime(a.start))}function y(){var t=new r({placement:d.Auto,contentWidth:"350px",showHeader:false,showArrow:true,verticalScrolling:true,horizontalScrolling:false,content:[C()]}).addStyleClass("sapUiSupportPopover");t.attachAfterOpen(function(t){t.getSource().$().focus()});return t}function C(){a=new s({icon:e.getIconURI("decline"),type:"Transparent",press:function(){S.close()}}).addStyleClass("sapUiSupportIntPopoverCloseButton");a.setTooltip("Close");p=(new i).addStyleClass("sapUiSupportIntRequestText");l=(new i).addStyleClass("sapUiSupportIntRequestText");c=(new i).addStyleClass("sapUiSupportIntRequestText");h=(new i).addStyleClass("sapUiSupportIntRequestText");v=(new i).addStyleClass("sapUiSupportIntRequestText");I=(new i).addStyleClass("sapUiSupportIntRequestText");f=(new i).addStyleClass("sapUiSupportIntRequestText");t=new n({maxContainerCols:2,minWidth:400,labelMinWidth:100,editable:false,layout:"ResponsiveGridLayout",labelSpanM:7,emptySpanM:0,columnsM:1,breakpointM:0,content:[new u({text:"INTERACTION DATA"}),new o({text:"Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),p,new o({text:"Client Processing Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),l,new o({text:"Total Requests Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),c,new o({text:"Roundtrip Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),h,new o({text:"Bytes Received"}).addStyleClass("sapUiSupportIntRequestLabel"),v,new o({text:"Request Count"}).addStyleClass("sapUiSupportIntRequestLabel"),I,new o({text:"Start Time"}).addStyleClass("sapUiSupportIntRequestLabel"),f]}).addStyleClass("sapUiSupportIntPopoverForm");return[a,t]}};c.prototype.renderRequestPart=function(t,e,a,r){if(this.actualStartTime>a||this.actualEndTime<e){return}a=Math.min(a,this.actualEndTime);e=Math.max(e,this.actualStartTime);var i=100/this.timeRange*(e-this.actualStartTime);var n=100/this.timeRange*(a-this.actualStartTime);var s=n-i;t.write('<span style="margin-left: '+i+"%; width: "+s+'%" class="sapUiInteractionTimeframe sapUiInteractionTimeRequestFrame '+r+'"></span>')};c.prototype.getRequestDuration=function(t){if(t.duration>0){return t.duration}var e=t.responseStart||t.requestStart||t.fetchStart;return e-t.startTime};c.prototype.getRequestRequestStart=function(t){if(t.requestStart>0){return t.requestStart}return t.fetchStart||t.startTime};c.prototype.getRequestResponseStart=function(t){if(t.responseStart>0){return t.responseStart}return t.requestStart||t.fetchStart||t.startTime};c.prototype.pad0=function(t,e){return("000"+String(t)).slice(-e)};c.prototype.formatGridLineDuration=function(t){var e=this.actualStartTime-this.startTime;t+=e;return t>100?(t/1e3).toFixed(2)+" s":t.toFixed(0)+" ms"};c.prototype.formatDuration=function(t){t=Math.max(t,0);if(t<3){return t.toFixed(2)+" ms"}return t>=1e3?(t/1e3).toFixed(3)+" s":t.toFixed(0)+" ms"};c.prototype.formatTime=function(t){var e=new Date(t);return this.pad0(e.getHours(),2)+":"+this.pad0(e.getMinutes(),2)+":"+this.pad0(e.getSeconds(),2)+"."+this.pad0(e.getMilliseconds(),3)};c.prototype.renderIcon=function(t,e){var a=this.getIconHTML(e);t.write(a)};c.prototype.getIconHTML=function(t){var a=t?c.collapseIcon:c.expandIcon;var r="sapUiIcon sapUiInteractionTreeIcon";if(n&&!n.suppressMirroring){r+=" sapUiIconMirrorInRTL"}var i='<span aria-hidden="true" expanded="'+t+'" class="'+r+'" ';var n=e.getIconInfo(a);if(n){i+='data-sap-ui-icon-content="'+n.content+'"';i+=" style=\"font-family:'SAP-icons'\""}i+="></span>";return i};return c});
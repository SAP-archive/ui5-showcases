/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/base/BindingParser","sap/ui/core/Element","sap/ui/model/BindingMode","sap/ui/model/CompositeBinding","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/base/util/JSTokenizer","sap/base/util/ObjectPath","sap/base/Log"],function(e,t,r,n,a,i,s,o,l,d){"use strict";var f={resolveEventHandler:function(e,r){var n;e=e.trim();if(sap.ui.getCore().getConfiguration().getControllerCodeDeactivated()){n=function(){}}else{var a=e.indexOf("("),o=e;if(a>0){o=e.substring(0,a).trim()}else if(a===0){throw new Error("Event handler name starts with a bracket, must start with a function name "+"(or with a dot followed by controller-local function name): "+e)}switch(o.indexOf(".")){case 0:n=r&&l.get(o.slice(1),r);break;case-1:n=r&&r[o];if(n!=null){break}default:n=l.get(o)}if(n&&a>0){var f=e.lastIndexOf(")");if(f>a){if(e.substring(a).indexOf("{=")>-1){d.warning("It looks like an event handler parameter contains a binding expression ({=...}). This is not allowed and will cause an error later on "+"because the entire event handler is already considered an expression: "+e)}n=function(r,n){return function(a){var o,l,d=e;if(e.indexOf("$parameters")>-1){o=new i(a.mParameters)}if(e.indexOf("$source")>-1){l=new s(a.getSource())}var f={$controller:n,$event:a};if(r.indexOf(".")>0){var u=r.split(".")[0];f[u]=window[u]}else if(r.indexOf(".")===-1){if(n&&n[r]){d="$controller."+d}else if(window[r]){f[r]=window[r]}}var c=t.parseExpression(d.replace(/^\./,"$controller."),0,{oContext:n},f);if(c.result){try{p(c.result,a.getSource(),n,o,l)}catch(t){t.message="Error when evaluating event handler '"+e+"': "+t.message;throw t}}if(o){o.destroy()}if(l){l.destroy()}}}(o,r)}else{d.error("Syntax error in event handler '"+e+"': arguments must be enclosed in a pair of brackets")}}}if(typeof n==="function"){n._sapui_handlerName=e;return[n,r]}d.warning("Event handler name '"+e+"' could not be resolved to an event handler function")},parse:function e(t){t=t.trim();var r=new o;var n=[];var a="";var i=0;r.init(t,0);for(;;){var s=r.next();if(s==='"'||s==="'"){var l=r.getIndex();r.string();a+=t.slice(l,r.getIndex());s=r.getCh()}if(!s){break}switch(s){case"(":i++;break;case")":i--;break}if(s===";"&&i===0){n.push(a.trim());a=""}else{a+=s}}if(a){n.push(a.trim())}return n}};function p(e,t,r,i,s){var o;e.mode=n.OneWay;if(!e.parts){e.parts=[];e.parts[0]={path:e.path,targetType:e.targetType,type:e.type,suspended:e.suspended,formatOptions:e.formatOptions,constraints:e.constraints,model:e.model,mode:e.mode};delete e.path;delete e.targetType;delete e.mode;delete e.model}for(var d=0;d<e.parts.length;d++){var f=e.parts[d];if(typeof f=="string"){f={path:f};e.parts[d]=f}if(!f.path&&f.parts){throw new Error("Bindings in event handler parameters cannot use parts. Just use one single path.")}var p=f.path.indexOf(">");if(p>0){f.model=f.path.substr(0,p);f.path=f.path.substr(p+1)}}var u,c,m=[];e.parts.forEach(function(r){var a;if(r.model==="$parameters"){a=i;u=i.createBindingContext("/")}else if(r.model==="$source"){a=s;u=s.createBindingContext("/")}else{a=t.getModel(r.model);u=t.getBindingContext(r.model)}o=r.type;if(typeof o=="string"){g=l.get(o);if(typeof g!=="function"){throw new Error('Cannot find type "'+o+'" used for binding "'+r.path+'"!')}o=new g(r.formatOptions,r.constraints)}c=a.bindProperty(r.path,u,e.parameters);c.setType(o,r.targetType||"any");c.setFormatter(r.formatter);c.setBindingMode(n.OneTime);m.push(c)});if(m.length>1||e.formatter&&e.formatter.textFragments){o=e.type;if(typeof o=="string"){var g=l.get(o);o=new g(e.formatOptions,e.constraints)}c=new a(m,e.useRawValues,e.useInternalValues);c.setType(o,f.targetType||"any");c.setBindingMode(n.OneTime)}else{c=m[0]}c.setFormatter(e.formatter);c.initialize();return c.getExternalValue()}return f});
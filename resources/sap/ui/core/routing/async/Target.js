/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/ComponentContainer","sap/ui/core/library"],function(e,t,n){"use strict";return{display:function(e){var t=Promise.resolve();return this._display(e,t)},_display:function(e,t,n){if(this._oParent){t=this._oParent._display(e,t,n)}return this._place(e,t,n)},_place:function(n,i,o){if(n instanceof Promise){o=i;i=n;n=undefined}var r=this._oOptions,a=this,s,c,u,l,d;if((r.name||r.usage)&&r.type){c=this._getEffectiveObjectName(r.name);switch(r.type){case"View":u={name:c,type:r.viewType,id:r.id,async:true};break;case"Component":u={id:r.id};if(r.usage){u.usage=r.usage}else{u.name=c}u=Object.assign({},r.options||{},u);break;default:throw new Error("The given type "+r.type+" isn't support by sap.ui.core.routing.Target")}s=this._oCache._get(u,r.type,this._bUseRawViewId,o);if(!(s instanceof Promise)){if(s.isA("sap.ui.core.mvc.View")){d=s.loaded()}else{d=Promise.resolve(s)}}else{d=s}i=i.then(function(e){return d.then(function(t){if(t.isA("sap.ui.core.UIComponent")){var n=t.getRouter();if(n&&n.isStopped()){n.initialize()}}return{object:t,parentInfo:e||{}}})}).then(function(e){var t=a._isValid(e.parentInfo);s=e.object;if(s.isA("sap.ui.core.mvc.View")){a._bindTitleInTitleProvider(s);a._addTitleProviderAsDependent(s)}if(t!==true){l=t;return a._refuseInvalidTarget(r._name,l)}var n=e.parentInfo.view,i=e.parentInfo.control,o=Promise.resolve(i);if(n&&n.isA("sap.ui.core.ComponentContainer")){n=n.getComponentInstance().getRootControl()}if(!n&&r.rootView){n=sap.ui.getCore().byId(r.rootView);if(!n){l="Did not find the root view with the id "+r.rootView;return a._refuseInvalidTarget(r._name,l)}}if(r.controlId){if(n&&n.isA("sap.ui.core.mvc.View")){o=n.loaded().then(function(e){return e.byId(r.controlId)})}o=o.then(function(e){if(!e){e=sap.ui.getCore().byId(r.controlId)}if(!e){l="Control with ID "+r.controlId+" could not be found";return a._refuseInvalidTarget(r._name,l)}else{return e}})}return o}).then(function(i){var o,u,d;if(s.isA("sap.ui.core.UIComponent")){o=s;u=o.getId()+"-container";s=sap.ui.getCore().byId(u);if(!s){var f=Object.assign({component:o,height:"100%",width:"100%",lifecycle:sap.ui.core.ComponentLifecycle.Application},r.containerOptions);s=new t(u,f);d=o.exit;o.exit=function(){if(d){d.apply(this)}s.destroy()}}}a._beforePlacingViewIntoContainer({container:i,view:s,data:n});var p=i.getMetadata().getJSONKeys()[r.controlAggregation];if(!p){l="Control "+r.controlId+" does not have an aggregation called "+r.controlAggregation;return a._refuseInvalidTarget(r._name,l)}if(r.clearControlAggregation===true){i[p._sRemoveAllMutator]()}e.info("Did place the "+r.type.toLowerCase()+" '"+c+"' with the id '"+s.getId()+"' into the aggregation '"+r.controlAggregation+"' of a control with the id '"+i.getId()+"'",a);i[p._sMutator](s);a.fireDisplay({view:s.isA("sap.ui.core.mvc.View")?s:undefined,object:s,control:i,config:a._oOptions,data:n});return{name:r._name,view:s,control:i}})}else{i=i.then(function(){return{name:r._name}})}return i},_isValid:function(t){var n=this._oOptions,i=t&&t.control,o=i||n.controlId,r=true,a="";if(!o){a="The target "+n._name+" has no controlId set and no parent so the target cannot be displayed.";r=false}if(!n.controlAggregation){a="The target "+n._name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";r=false}if(a){e.error(a,this)}return r||a},_refuseInvalidTarget:function(e,t){return Promise.reject(new Error(t+" - Target: "+e))}}});
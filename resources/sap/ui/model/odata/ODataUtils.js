/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/Sorter","sap/ui/model/FilterProcessor","sap/ui/core/format/DateFormat","sap/base/Log","sap/base/assert","sap/ui/thirdparty/jquery","sap/base/security/encodeURL","sap/ui/core/CalendarType"],function(e,r,t,n,a,i,s,o){"use strict";var u=/^([-+]?)0*(\d+)(\.\d+|)$/,f=/\.$/,c=/0+$/;var l=function(){};l.createSortParams=function(r){var t;if(!r||r.length==0){return}t="$orderby=";for(var a=0;a<r.length;a++){var i=r[a];if(i instanceof e){t+=i.sPath;t+=i.bDescending?"%20desc":"%20asc";t+=","}else{n.error("Trying to use "+i+" as a Sorter, but it is a "+typeof i)}}t=t.slice(0,-1);return t};l.createFilterParams=function(e,t,n){var a=Array.isArray(e)?r.groupFilters(e):e;if(!a){return}return"$filter="+this._createFilterParams(a,t,n)};l._createFilterParams=function(e,t,n){var a=this,i=Array.isArray(e)?r.groupFilters(e):e;function s(e,r){if(e.aFilters){return o(e,r)}return a._createFilterSegment(e.sPath,t,n,e.sOperator,e.oValue1,e.oValue2,e.bCaseSensitive)}function o(e,r){var t=e.aFilters,n=!!e.bAnd,a="";if(t.length===0){return n?"true":"false"}if(t.length===1){if(t[0]._bMultiFilter){return s(t[0])}return s(t[0],true)}if(!r){a+="("}a+=s(t[0]);for(var i=1;i<t.length;i++){a+=n?"%20and%20":"%20or%20";a+=s(t[i])}if(!r){a+=")"}return a}if(!i){return}return s(i,true)};l._createUrlParamsArray=function(e){var r,t=i.type(e),n;if(t==="array"){return e}r=[];if(t==="object"){n=this._encodeURLParameters(e);if(n){r.push(n)}}else if(t==="string"){if(e){r.push(e)}}return r};l._encodeURLParameters=function(e){if(!e){return""}var r=[];i.each(e,function(e,t){if(i.type(t)==="string"){t=encodeURIComponent(t)}e=e.startsWith("$")?e:encodeURIComponent(e);r.push(e+"="+t)});return r.join("&")};l.setOrigin=function(e,r){var t,a,i;if(!e||!r||e.indexOf(";mo")>0){return e}if(typeof r=="string"){t=r}else{t=r.alias;if(!t){a=r.system;i=r.client;if(!a||!i){n.warning("ODataUtils.setOrigin: No Client or System ID given for Origin");return e}t="sid("+a+"."+i+")"}}var s=e.split("?");var o=s[0];var u=s[1]?"?"+s[1]:"";var f="";if(o[o.length-1]==="/"){o=o.substring(0,o.length-1);f="/"}var c=/(\/[^\/]+)$/g;var l=/(;o=[^\/;]+)/g;var m=o.match(c)[0];var d=m.match(l);var g=d?d[0]:null;if(g){if(r.force){var p=m.replace(g,";o="+t);o=o.replace(m,p);return o+f+u}return e}o=o+";o="+t+f;return o+u};l.setAnnotationOrigin=function(e,r){var t;var a=e.indexOf("/Annotations(");var i=r&&r.preOriginBaseUri?r.preOriginBaseUri.indexOf(".xsodata"):-1;if(a===-1){a=e.indexOf("/Annotations%28")}if(a>=0){if(e.indexOf("/$value",a)===-1){n.warning("ODataUtils.setAnnotationOrigin: Annotation url is missing $value segment.");t=e}else{var s=e.substring(0,a);var o=e.substring(a,e.length);var u=l.setOrigin(s,r);t=u+o}}else if(i>=0){t=l.setOrigin(e,r)}else{t=e.replace(r.preOriginBaseUri,r.postOriginBaseUri)}return t};l._resolveMultiFilter=function(e,r,t){var n=this,a=e.aFilters,s="";if(a){s+="(";i.each(a,function(i,o){if(o._bMultiFilter){s+=n._resolveMultiFilter(o,r,t)}else if(o.sPath){s+=n._createFilterSegment(o.sPath,r,t,o.sOperator,o.oValue1,o.oValue2,"",o.bCaseSensitive)}if(i<a.length-1){if(e.bAnd){s+="%20and%20"}else{s+="%20or%20"}}});s+=")"}return s};l._createFilterSegment=function(e,r,t,i,o,u,f){var c,l;if(f===undefined){f=true}if(t){c=r._getPropertyMetadata(t,e);l=c&&c.type;a(c,"PropertyType for property "+e+" of EntityType "+t.name+" not found!")}if(l){o=this.formatValue(o,l,f);u=u!=null?this.formatValue(u,l,f):null}else{a(null,"Type for filter property could not be found in metadata!")}if(o){o=s(String(o))}if(u){u=s(String(u))}if(!f&&l==="Edm.String"){e="toupper("+e+")"}switch(i){case"EQ":case"NE":case"GT":case"GE":case"LT":case"LE":return e+"%20"+i.toLowerCase()+"%20"+o;case"BT":return"("+e+"%20ge%20"+o+"%20and%20"+e+"%20le%20"+u+")";case"NB":return"not%20("+e+"%20ge%20"+o+"%20and%20"+e+"%20le%20"+u+")";case"Contains":return"substringof("+o+","+e+")";case"NotContains":return"not%20substringof("+o+","+e+")";case"StartsWith":return"startswith("+e+","+o+")";case"NotStartsWith":return"not%20startswith("+e+","+o+")";case"EndsWith":return"endswith("+e+","+o+")";case"NotEndsWith":return"not%20endswith("+e+","+o+")";default:n.error("ODataUtils :: Unknown filter operator "+i);return"true"}};l.formatValue=function(e,r,n){if(n===undefined){n=true}if(!this.oDateTimeFormat){this.oDateTimeFormat=t.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:o.Gregorian});this.oDateTimeFormatMs=t.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:o.Gregorian});this.oDateTimeOffsetFormat=t.getDateInstance({pattern:"'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''",calendarType:o.Gregorian});this.oTimeFormat=t.getTimeInstance({pattern:"'time''PT'HH'H'mm'M'ss'S'''",calendarType:o.Gregorian})}if(e===null||e===undefined){return"null"}var a;switch(r){case"Edm.String":e=n?e:e.toUpperCase();a="'"+String(e).replace(/'/g,"''")+"'";break;case"Edm.Time":if(typeof e==="object"){a=this.oTimeFormat.format(new Date(e.ms),true)}else{a="time'"+e+"'"}break;case"Edm.DateTime":var i=new Date(e);if(i.getMilliseconds()>0){a=this.oDateTimeFormatMs.format(i,true)}else{a=this.oDateTimeFormat.format(i,true)}break;case"Edm.DateTimeOffset":var i=new Date(e);a=this.oDateTimeOffsetFormat.format(i,true);break;case"Edm.Guid":a="guid'"+e+"'";break;case"Edm.Decimal":a=e+"m";break;case"Edm.Int64":a=e+"l";break;case"Edm.Double":a=e+"d";break;case"Edm.Float":case"Edm.Single":a=e+"f";break;case"Edm.Binary":a="binary'"+e+"'";break;default:a=String(e);break}return a};function m(e,r){if(e===r){return 0}if(e===null||r===null||e===undefined||r===undefined){return NaN}return e>r?1:-1}function d(e){var r;if(typeof e!=="string"){return undefined}r=u.exec(e);if(!r){return undefined}return{sign:r[1]==="-"?-1:1,integerLength:r[2].length,abs:r[2]+r[3].replace(c,"").replace(f,"")}}function g(e,r){var t,n,a;if(e===r){return 0}t=d(e);n=d(r);if(!t||!n){return NaN}if(t.sign!==n.sign){return t.sign>n.sign?1:-1}a=m(t.integerLength,n.integerLength)||m(t.abs,n.abs);return t.sign*a}var p=/^PT(\d\d)H(\d\d)M(\d\d)S$/;function h(e){if(typeof e==="string"&&p.test(e)){e=parseInt(RegExp.$1)*36e5+parseInt(RegExp.$2)*6e4+parseInt(RegExp.$3)*1e3}if(e instanceof Date){return e.getTime()}if(e&&e.__edmType==="Edm.Time"){return e.ms}return e}l.compare=function(e,r,t){return t?g(e,r):m(h(e),h(r))};l.getComparator=function(e){switch(e){case"Edm.Date":case"Edm.DateTime":case"Edm.DateTimeOffset":case"Edm.Time":return l.compare;case"Edm.Decimal":case"Edm.Int64":return g;default:return m}};var y=/([(=,])('.*?')([,)])/g,v=/[MLDF](?=[,)](?:[^']*'[^']*')*[^']*$)/g,b=/([(=,])(X')/g,T=function(e,r,t,n){return r+encodeURIComponent(decodeURIComponent(t))+n},D=function(e){return e.toLowerCase()},E=function(e,r){return r+"binary'"};l._normalizeKey=function(e){return e.replace(y,T).replace(v,D).replace(b,E)};return l},true);
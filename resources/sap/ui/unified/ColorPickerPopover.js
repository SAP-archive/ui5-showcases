/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/Device","sap/m/Button","sap/m/ResponsivePopover","./ColorPicker","./library","sap/m/library"],function(e,t,o,r,i,n,p){"use strict";var a=p.PlacementType;var s=n.ColorPickerMode,l=n.ColorPickerDisplayMode;var u=e.extend("sap.ui.unified.ColorPickerPopover",{metadata:{library:"sap.ui.unified",publicMethods:["openBy","close"],properties:{colorString:{type:"string",group:"Misc",defaultValue:null},mode:{type:"sap.ui.unified.ColorPickerMode",group:"Appearance",defaultValue:s.HSV},displayMode:{type:"sap.ui.unified.ColorPickerDisplayMode",group:"Appearance",defaultValue:l.Default}},events:{change:{parameters:{r:{type:"int"},g:{type:"int"},b:{type:"int"},h:{type:"int"},s:{type:"int"},v:{type:"int"},l:{type:"int"},hex:{type:"string"},alpha:{type:"string"}}}}},renderer:{}});var P=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");var c={COLOR_PICKER_PROPS:{colorString:"setColorString",mode:"setMode",displayMode:"setDisplayMode"},POPOVER_METHODS:{getDomRef:"",close:""}};u.prototype.init=function(){this._oPopover=null;this._bPopoverDestroying=null};u.prototype.exit=function(){this._bPopoverDestroying=true;if(this._oPopover){this._oPopover.removeDelegate(this._oPopover._onAfterRenderingDelegate);this._oPopover.destroy();this._oPopover=null}};u.prototype.openBy=function(e){return r.prototype.openBy.apply(this._ensurePopover(),arguments)};u.prototype._getColorPicker=function(){return this._ensurePopover().getContent()[0]};u.prototype._ensurePopover=function(){if(!this._oPopover){this._oPopover=this._createPopover()}return this._oPopover};u.prototype._createPopover=function(){var e,i=this._createColorPicker(),n,p=this;e=new r(this.getId()+"-colorPickerPopover",{showHeader:t.system.phone,placement:a.VerticalPreferredBottom,showArrow:false,showCloseButton:false,beginButton:new o({text:P.getText("COLOR_PICKER_SUBMIT"),press:function(){p.fireChange(p._oLastChangeCPParams);e.close()}}),endButton:new o({text:P.getText("COLOR_PICKER_CANCEL"),press:function(){e.close()}}),title:P.getText("COLOR_PICKER_TITLE"),content:i});i.attachEvent("change",function(e){this._handleChange(e)}.bind(this));n={onAfterRendering:function(){var e=this.$();e.attr("aria-modal","true");e.attr("aria-label",this.getTitle())}};e.addEventDelegate(n,e);e._onAfterRenderingDelegate=n;return e};u.prototype._handleChange=function(e){var t={};this._oLastChangeCPParams=jQuery.extend(t,e.getParameters());delete this._oLastChangeCPParams.id;return this};u.prototype._createColorPicker=function(){var e=new i(this.getId()+"-color_picker");return e};u.prototype.setProperty=function(t,o,r){var n;if(c.COLOR_PICKER_PROPS[t]!==undefined){n=c.COLOR_PICKER_PROPS[t]||t;i.prototype[n].call(this._getColorPicker(),o)}return e.prototype.setProperty.apply(this,arguments)};Object.keys(c.POPOVER_METHODS).forEach(function(e){var t=c.POPOVER_METHODS[e]||e;u.prototype[e]=function(){if(this._bPopoverDestroying){return null}var e=this._ensurePopover();return e[t].apply(e,arguments)}});return u});